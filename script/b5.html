<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>B5: Web Services </title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="B5: Web Services "/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-01-03T18:26+0100"/>
<meta name="author" content="Marc Wilhelm Küster"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">B5: Web Services </h1>


<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">B5 "Web Services"</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Marc Wilhelm Küster</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.<br />Based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/mwkuster/b5" rel="dct:source">https://github.com/mwkuster/b5</a>.

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Objectives and Formalia</a>
<ul>
<li><a href="#sec-1-1">1.1 Course objectives</a></li>
<li><a href="#sec-1-2">1.2 Programming project</a></li>
<li><a href="#sec-1-3">1.3 Preconditions</a></li>
</ul>
</li>
<li><a href="#sec-2">2 RESTful Web Services and Resource Oriented Architectures</a>
<ul>
<li><a href="#sec-2-1">2.1 The HTTP protocol</a>
<ul>
<li><a href="#sec-2-1-1">2.1.1 HTTP methods and their use</a></li>
<li><a href="#sec-2-1-2">2.1.2 Error handling</a></li>
<li><a href="#sec-2-1-3">2.1.3 Content negotiation</a></li>
<li><a href="#sec-2-1-4">2.1.4 Assignment</a></li>
<li><a href="#sec-2-1-5">2.1.5 Command line tools such as curl and wget</a></li>
<li><a href="#sec-2-1-6">2.1.6 Encryption and caching</a></li>
</ul>
</li>
<li><a href="#sec-2-2">2.2 Design principles for RESTful systems</a></li>
</ul>
</li>
<li><a href="#sec-3">3 Excursion: Ruby</a></li>
<li><a href="#sec-4">4 Programming RESTful Web Services: Client side web services</a>
<ul>
<li><a href="#sec-4-1">4.1 Design of URIs</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1 URI Templates</a></li>
<li><a href="#sec-4-1-2">4.1.2 The case of the European Legislation Identifier (ELI)</a></li>
<li><a href="#sec-4-1-3">4.1.3 URITemplates in Ruby</a></li>
<li><a href="#sec-4-1-4">4.1.4 Excursion: Handling URITemplates in Clojure</a></li>
</ul>
</li>
<li><a href="#sec-4-2">4.2 JSON</a>
<ul>
<li><a href="#sec-4-2-1">4.2.1 JSON and Ruby</a></li>
<li><a href="#sec-4-2-2">4.2.2 Excursion: JSON and Clojure</a></li>
</ul>
</li>
<li><a href="#sec-4-3">4.3 Assignment</a></li>
<li><a href="#sec-4-4">4.4 ATOM and related standards</a>
<ul>
<li><a href="#sec-4-4-1">4.4.1 Ruby and ATOM</a></li>
<li><a href="#sec-4-4-2">4.4.2 Excursion: Clojure, Rome and <code>clj-rome</code></a></li>
</ul>
</li>
<li><a href="#sec-4-5">4.5 Ruby Libraries for client-side RESTful web services</a></li>
<li><a href="#sec-4-6">4.6 Libraries for RESTful web services for Java and Clojure</a></li>
<li><a href="#sec-4-7">4.7 Web Services the Google way</a>
<ul>
<li><a href="#sec-4-7-1">4.7.1 Account and authentication</a></li>
<li><a href="#sec-4-7-2">4.7.2 Accessing the API</a></li>
</ul>
</li>
<li><a href="#sec-4-8">4.8 OAuth2</a></li>
<li><a href="#sec-4-9">4.9 Assignment</a></li>
</ul>
</li>
<li><a href="#sec-5">5 Server-side REST</a>
<ul>
<li><a href="#sec-5-1">5.1 Sinatra</a></li>
<li><a href="#sec-5-2">5.2 The OAuth2 callback</a></li>
<li><a href="#sec-5-3">5.3 The Giant Global Graph: Facebook</a></li>
<li><a href="#sec-5-4">5.4 Assignment</a></li>
<li><a href="#sec-5-5">5.5 <code>budabe-graph</code></a></li>
<li><a href="#sec-5-6">5.6 Creating a Facebook application</a></li>
<li><a href="#sec-5-7">5.7 Assignment</a></li>
<li><a href="#sec-5-8">5.8 Facebook and graphs</a></li>
</ul>
</li>
<li><a href="#sec-6">6 The Semantic Web</a></li>
<li><a href="#sec-7">7 Preparing the Practical Programming Projects</a></li>
<li><a href="#sec-8">8 Web Services and the Semantic Web</a>
<ul>
<li><a href="#sec-8-1">8.1 RDF Serialization formats</a>
<ul>
<li><a href="#sec-8-1-1">8.1.1 Turtle</a></li>
<li><a href="#sec-8-1-2">8.1.2 RDF/XML</a></li>
<li><a href="#sec-8-1-3">8.1.3 RDFa</a></li>
</ul>
</li>
<li><a href="#sec-8-2">8.2 Exercise: Markup of a web page</a></li>
<li><a href="#sec-8-3">8.3 SPARQL</a></li>
<li><a href="#sec-8-4">8.4 Programming the Semantic Web in Ruby</a></li>
<li><a href="#sec-8-5">8.5 Programming the Semantic Web in Clojure</a></li>
<li><a href="#sec-8-6">8.6 Excursion: Facebook and RDFa: the Open Graph protocol</a></li>
</ul>
</li>
<li><a href="#sec-9">9 Testing RESTful Web Services</a></li>
<li><a href="#sec-10">10 Bibliography</a></li>
<li><a href="#sec-11">11 Excursion: Neo4j: a RESTful Database</a>
<ul>
<li>
<ul>
<li><a href="#sec-11-1">11.1 What is Neo4j?</a></li>
</ul>
</li>
<li><a href="#sec-11-1">11.1 Neo4j's admin interface</a></li>
<li><a href="#sec-11-2">11.2 Neo4j's RESTful interface</a></li>
<li><a href="#sec-11-3">11.3 Cypher</a></li>
<li><a href="#sec-11-4">11.4 Neocons</a>
<ul>
<li><a href="#sec-11-4-1">11.4.1 Assignment</a></li>
</ul>
</li>
<li><a href="#sec-11-5">11.5 Accessing RESTful storage</a>
<ul>
<li><a href="#sec-11-5-1">11.5.1 Security</a></li>
<li><a href="#sec-11-5-2">11.5.2 Creating an object</a></li>
<li><a href="#sec-11-5-3">11.5.3 Atmosfox</a></li>
<li><a href="#sec-11-5-4">11.5.4 Handling of Metadata</a></li>
<li><a href="#sec-11-5-5">11.5.5 Assignment</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-12">12 Excursion: Clojure and JVM</a>
<ul>
<li><a href="#sec-12-1">12.1 Why Clojure?</a></li>
<li><a href="#sec-12-2">12.2 Practicalities</a>
<ul>
<li><a href="#sec-12-2-1">12.2.1 Tutorials</a></li>
<li><a href="#sec-12-2-2">12.2.2 Installation and integration with Emacs</a></li>
<li><a href="#sec-12-2-3">12.2.3 Leiningen</a></li>
<li><a href="#sec-12-2-4">12.2.4 Syntax and data structures</a></li>
</ul>
</li>
<li><a href="#sec-12-3">12.3 Control structures</a></li>
<li><a href="#sec-12-4">12.4 Lazy sequences</a></li>
<li><a href="#sec-12-5">12.5 Assignment</a></li>
<li><a href="#sec-12-6">12.6 Principles of functional programming</a></li>
<li><a href="#sec-12-7">12.7 Futures</a></li>
<li><a href="#sec-12-8">12.8 Multimethods: Polymorphism functional style</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Objectives and Formalia</h2>
<div class="outline-text-2" id="text-1">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2013-10-04 Fri</span></span>
</p>
</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Course objectives</h3>
<div class="outline-text-3" id="text-1-1">

<p>Mastering the concepts and implementation of heterogeneous, loosely-coupled architectures using a substantial practical programming project
</p>

</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Programming project</h3>
<div class="outline-text-3" id="text-1-2">

<p>Course success is measured through a practical programming project,
followed by a short oral exam. This project can be started after the
basic web service part is over. I will suggest topics, but
participants can also propose their own projects as long as the
technologies fit in the overall scope of the course.
</p>
<p>
You can and should work in teams of two.
</p>
<p>
Precondition for participating in the practical programming project is regular participation in the practical courses. You must pass at least 80% of the weekly assignments. An assignment is considered a pass if you have at least 50 of points out of 100.
</p>
<p>
Repeating the exam means a second, new practical project followed by a second oral exam.
</p>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Preconditions</h3>
<div class="outline-text-3" id="text-1-3">

<ul>
<li>Registration for course and exam within deadlines
</li>
<li>Participating in the final exam depends on having successfully completed a practical programming project
</li>
<li>Solid programming expertise
</li>
<li>Exam: consists of a practical programming project followed by a presentation and an oral exam
</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> RESTful Web Services and Resource Oriented Architectures</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> The HTTP protocol</h3>
<div class="outline-text-3" id="text-2-1">

<p>The Hypertext Transfer Protocol (HTTP) or RFC 2616 is next to the Uniform Resource Identifier (URI) the most important standard for the Web as we know it. Whenever we access anything on the web through a browser, we trigger at least one HTTP request, typically many. And not only through a browser: any mobile device uses HTTP requests, as do many software tools that are not browsers at all. 
</p>
<p>               
In this session we will learn more about this specification and how it is used. Fortunately, the specification {Fielding:1999ub} itself is very clear and readable. It sets out with the HTTP's overall objective:
</p>
<blockquote>

<p>The Hypertext Transfer Protocol (HTTP) is an application-level protocol for distributed, collaborative, hypermedia information systems. It is a generic, stateless, protocol which can be used for many tasks beyond its use for hypertext, such as name servers and distributed object management systems, through extension of its request methods, error codes and headers. A feature of HTTP is the typing and negotiation of data representation, allowing systems to be built independently of the data being transferred (<a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">http://www.w3.org/Protocols/rfc2616/rfc2616.html</a>)
</p>
</blockquote>



<p>               
The key phrase &mdash; and probably the main technical reason for HTTP's success &mdash; is <i>stateless</i>. Generally, HTTP operates on pairs of request and response. Once a request has received its response, the protocol keeps no memory of the interaction, making each interaction independent. Of course, an HTTP request can very well change the state of the recipient, for example by adding a resource &mdash; we'll shortly see how &mdash;, but this remains transparent for the next request / response pair. The next interaction has no inherent knowledge if the state of the server has just been changed a millisecond earlier, was changed a month ago or has always been in this state: "interaction is stateless between requests" ({Fielding:2000vh}, 5.3.1). The server also has no need to keep a state related to the concrete set of interactions, nor even which sequence of interactions come from the same sender. "Session state is therefore kept entirely on the client" ({Fielding:2000vh}, 5.1.3).
</p>
<p>               
If this sounds abstract, at the core it means that a sender &mdash; let's say, the browser &mdash; asks a server for a webpage, giving a URI to identify that page:
</p>



<pre class="example">-----------   Get Webpage       ----------
|         | ------------------&gt; |        |
| Browser |                     | Server |
|         | &lt;------------------ |        |
-----------  Send webpage       ----------
</pre>


<p>
In reply, the server sends back the content of that website to the browser, and that's it.
</p>
<p>
Of course, there's a bit more to it, though the principle does not change.
</p>

</div>

<div id="outline-container-2-1-1" class="outline-4">
<h4 id="sec-2-1-1"><span class="section-number-4">2.1.1</span> HTTP methods and their use</h4>
<div class="outline-text-4" id="text-2-1-1">

<ul>
<li id="sec-2-1-1-1">GET-method<br/>
In the easiest scenario, the client just wants to get some content from the server. In this case sends a request that is in fact just called <code>GET</code>:



<pre class="example">$curl -v http://www.budabe.eu/research/
--&gt; 
GET /research/ HTTP/1.1
User-Agent: curl/7.27.0
Host: www.budabe.eu
Accept: */*
</pre>


<p>
This says pretty much what it seems to say: request the server to <code>GET</code> the URL webpage <code>/research</code> on the host <code>www.budabe.eu</code> and return its contents. If the page exists, the server responds by sending it back:
</p>



<pre class="example">&lt; HTTP/1.1 200 OK
&lt; Date: Sat, 22 Sep 2012 15:09:33 GMT
&lt; Server: Apache/2.2.20 (Ubuntu)
&lt; Vary: Accept-Language,Cookie,Accept-Encoding
&lt; Content-Language: de-de
&lt; Transfer-Encoding: chunked
&lt; Content-Type: text/html; charset=utf-8
&lt; 
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"&gt;&lt;!-- mode: nxml; code: utf-8; --&gt;
&lt;html version="-//W3C//DTD XHTML 1.1//EN" xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;head&gt;
    &lt;title&gt;
Research
&lt;/title&gt;
[...]
</pre>


<p>
Again, this says pretty much what it seems to say: On a given date the server sends back an html-page (-Content-Type: text/htm-) encoded in Unicode and more precisely UTF-8. The most cryptic and at the same time the most important part of this is the <code>200</code> part, though, that says that the request has succeeded. The <code>200</code> return code is specified RFC 2616 alongside 37 others. We'll come back to these codes below.
</p>
<p>
Formally, <code>GET</code> is defined as:
</p>
<blockquote>

<p>The GET method means retrieve whatever information (in the form of an entity) is identified by the Request-URI. If the Request-URI refers to a data-producing process, it is the produced data which shall be returned as the entity in the response and not the source text of the process, unless that text happens to be the output of the process ({Fielding:1999ub}, 9.3)
</p>
</blockquote>


<p>
<code>GET</code> returns existing webpages or more abstractly resources, if they exist, but it does not modify it. You can execute it any number of times, it will always return the resource. For this reason, it is called an idempotent method.
</p>
</li>
</ul>
<ul>
<li id="sec-2-1-1-2">HEAD-method<br/>
"The HEAD method is identical to GET except that the server MUST NOT return a message-body in the response" ({Fielding:1999ub}, 9.4):



<pre class="example">$ curl -v -XHEAD  http://www.budabe.eu/research/ 
--&gt;
&gt; HEAD /research/ HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: www.budabe.eu
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 200 OK
&lt; Date: Sat, 22 Sep 2012 15:31:18 GMT
&lt; Server: Apache/2.2.20 (Ubuntu)
&lt; Vary: Accept-Language,Cookie,Accept-Encoding
&lt; Content-Language: de-de
&lt; Content-Type: text/html; charset=utf-8
 no chunk, no close, no size. Assume close to signal end
&lt; 
</pre>


<p>
Since the server does not return data, it is a quick way to test if a resource exists, is accessible and / or has recently been modified. Like <code>GET</code> <code>HEAD</code> is also idempotent.
</p>
</li>
</ul>
<ul>
<li id="sec-2-1-1-3">DELETE-method<br/>
Another idempotent method is <code>DELETE</code> that does exactly what you'd assume it does: "The DELETE method requests that the origin server delete the resource identified by the Request-URI" ({Fielding:1999ub}, 9.7):




<pre class="example">$ curl -v -XDELETE  http://www.budabe.eu/research/
--&gt;
&gt; DELETE /research/ HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: www.budabe.eu
&gt; Accept: */*
&gt; 
</pre>


<p>
Of course, this does not mean that the sender has necessarily the right to do this and that the server will actually delete a resource. In this case, the server return a <code>403</code> (= forbidden) to indicate that it has no intention to delete it:
</p>


<pre class="example">&lt; HTTP/1.1 403 FORBIDDEN
&lt; Date: Sat, 22 Sep 2012 15:28:08 GMT
&lt; Server: Apache/2.2.20 (Ubuntu)
&lt; Vary: Accept-Language,Cookie,Accept-Encoding
&lt; Content-Language: de-de
&lt; Transfer-Encoding: chunked
&lt; Content-Type: text/html
&lt; 
</pre>


<p>
<code>DELETE</code> is also idempotent in that we can issue it any number of times, the result will always be the same (i.e. given necessary rights the resource will have disappeared).
</p>
</li>
</ul>
<ul>
<li id="sec-2-1-1-4">PUT-method<br/>
Another idempotent method is the <code>PUT</code> method. It "requests that the enclosed entity be stored under the supplied Request-URI. If the Request-URI refers to an already existing resource, the enclosed entity SHOULD be considered as a modified version of the one residing on the origin server. If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI. If a new resource is created, the origin server MUST inform the user agent via the 201 (Created) response" ({Fielding:1999ub}, 9.6). In other words, the client asks the server to generate a new resource or update an existing one for a given URI. The server has no leaway, it must create or update the resource under that URI or refuse the action.

<p>
In the following example the server is requested to create a page <code>/research/WebService</code> that currently does not exist:
</p>



<pre class="example">$ curl -v -XPUT -d "01234567890123456789012345"  http://www.budabe.eu/research/WebService
--&gt;
&gt; PUT /research/WebService HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: www.budabe.eu
&gt; Accept: */*
&gt; Content-Length: 26
&gt; Content-Type: application/x-www-form-urlencoded
&gt; 
 upload completely sent off: 26 out of 26 bytes
</pre>


<p>
As a payload, the string "Data for this new resource", which has a length of 26 bytes, is sent along.
</p>
<p>
Of course, as always the fact that you can send a <code>PUT</code> request to the server does not mean you have the necessary rights.
</p>



<pre class="example">&lt; HTTP/1.1 403 FORBIDDEN
&lt; Date: Sun, 23 Sep 2012 10:08:50 GMT
&lt; Server: Apache/2.2.20 (Ubuntu)
&lt; Vary: Accept-Language,Cookie,Accept-Encoding
&lt; Content-Language: de-de
&lt; Transfer-Encoding: chunked
&lt; Content-Type: text/html
</pre>


<p>
Similarly, the following request asks for an update to an existing resource with the same 26 characters: 
</p>



<pre class="example">$ curl -v -XPUT -d "01234567890123456789012345"  http://www.budabe.eu/research/WebService
--&gt;
&gt; PUT /research/ HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: www.budabe.eu
&gt; Accept: */*
&gt; Content-Length: 26
&gt; Content-Type: application/x-www-form-urlencoded
&gt; 
 upload completely sent off: 26 out of 26 bytes
</pre>


<p>
If this had succeeded, the (existing) page <a href="http://www.budabe.eu/research/">http://www.budabe.eu/research/</a> would now have the new content.
</p>
<p>
Since the precondition for <code>PUT</code> is that the client knows the URI to which the data sent will be applied, this method is virtually always used ot update existing resources, not to create new ones.
</p>
<p>
If you had the rights, the answer would obligatorily have been <code>201</code> in both cases.
</p>
</li>
</ul>
<ul>
<li id="sec-2-1-1-5">POST-method<br/>
If <code>PUT</code> normally updates existing resources, <code>POST</code> ist used to create new resources under a given URI. The client does not know in advance what the new URI will be, but will be informed by the server about this when things go according to plan. The server has a certain flexibility in interpreting the right action:

<blockquote>

<p>The actual function performed by the POST method is determined by the server and is usually dependent on the Request-URI. The posted entity is subordinate to that URI in the same way that a file is subordinate to a directory containing it, a news article is subordinate to a newsgroup to which it is posted, or a record is subordinate to a database.
</p>
</blockquote>


<p>
Possible positive responses are:
</p>
<ul>
<li>200 (OK) or 204 (No Content) if no resource was created, but the action want OK
</li>
<li>201 (Created) with a reference to the new resource if a new resource was created
</li>
</ul>



</li>
</ul>
</div>

</div>

<div id="outline-container-2-1-2" class="outline-4">
<h4 id="sec-2-1-2"><span class="section-number-4">2.1.2</span> Error handling</h4>
<div class="outline-text-4" id="text-2-1-2">

<p>One of the strenghts of the HTTP protocol is that it has a clear semantics for handling possible errors through well-defined response codes. Leaving aside the hardly-ever used 1xx series of responses we have:
</p>
<ul>
<li>Successful 2xx 
<ul>
<li>200 OK 
</li>
<li>201 Created 
</li>
<li>202 Accepted 
</li>
<li>203 Non-Authoritative Information 
</li>
<li>204 No Content 
</li>
<li>205 Reset Content 
</li>
<li>206 Partial Content 
</li>
</ul>

</li>
<li>Redirection 3xx 
<ul>
<li>300 Multiple Choices 
</li>
<li>301 Moved Permanently 
</li>
<li>302 Found 
</li>
<li>303 See Other 
</li>
<li>304 Not Modified 
</li>
<li>305 Use Proxy 
</li>
<li>306 (Unused) 
</li>
<li>307 Temporary Redirect 
</li>
</ul>

</li>
<li>Client Error 4xx 
<ul>
<li>400 Bad Request 
</li>
<li>401 Unauthorized 
</li>
<li>402 Payment Required 
</li>
<li>403 Forbidden 
</li>
<li>404 Not Found 
</li>
<li>405 Method Not Allowed 
</li>
<li>406 Not Acceptable 
</li>
<li>407 Proxy Authentication Required 
</li>
<li>408 Request Timeout 
</li>
<li>409 Conflict 
</li>
<li>410 Gone 
</li>
<li>411 Length Required 
</li>
<li>412 Precondition Failed 
</li>
<li>413 Request Entity Too Large 
</li>
<li>414 Request-URI Too Long 
</li>
<li>415 Unsupported Media Type 
</li>
<li>416 Requested Range Not Satisfiable 
</li>
<li>417 Expectation Failed 
</li>
</ul>

</li>
<li>Server Error 5xx 
<ul>
<li>500 Internal Server Error 
</li>
<li>501 Not Implemented 
</li>
<li>502 Bad Gateway 
</li>
<li>503 Service Unavailable 
</li>
<li>504 Gateway Timeout 
</li>
<li>505 HTTP Version Not Supported 
</li>
</ul>

</li>
</ul>


</div>

</div>

<div id="outline-container-2-1-3" class="outline-4">
<h4 id="sec-2-1-3"><span class="section-number-4">2.1.3</span> Content negotiation</h4>
<div class="outline-text-4" id="text-2-1-3">

<p>So far we have seen only requests with the HTTP header <code>Accept: */*</code>, which essentially says that you have no preference for the type of content to get back. However, normally clients have preferences for some type of content in some language over other types of content. In a typical browser session we see sequences like this:
</p>



<pre class="example">Request:
http://www.budabe.eu/research/

GET /research/ HTTP/1.1
Host: www.budabe.eu
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:12.0) Gecko/20100101 Firefox/12.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate

Response:
HTTP/1.1 200 OK
Date: Sun, 23 Sep 2012 17:19:33 GMT
Server: Apache/2.2.20 (Ubuntu)
Vary: Accept-Language,Cookie,Accept-Encoding
Content-Language: de
Content-Encoding: gzip
Keep-Alive: timeout=5, max=100
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/html; charset=utf-8
</pre>

<p>
(protocol of a live session taken with the Live HTTP headers plugin in Firefox)
</p>
<p>
In contrast to the HTTP method the HTTP headers always follow the model: Header name ':' value of the header followed by a newline (theoretically a line continuation is possible, but rarely seen) (cf. {Fielding:1999ub}, 2.2 for the details of the BNF rules). In particular, <code>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code>
 requests in the order of preference <code>text/html</code> and XHTML (<code>application/xhtml+xml</code>), then other formats. The server is expected to honour these requests. Similarly, <code>Accept-Language</code> specifies a preference for German (<code>de</code>) over English (<code>en</code>). More languages are possible.
</p>
<p>
The very same logic can also be used for more web-service type requests to deliberatedly ask for some languages or content types.
</p>
</div>

</div>

<div id="outline-container-2-1-4" class="outline-4">
<h4 id="sec-2-1-4"><span class="section-number-4">2.1.4</span> Assignment</h4>
<div class="outline-text-4" id="text-2-1-4">

<ol>
<li>Pick a website of your choice and download it using curl. Execute then DELETE, PUT and POST requests with curl
</li>
<li>Do the same exercise directly using telnet [domain] 80
</li>
</ol>


<p>
Copy the protocol of your terminal session into a text file and upload it. Hand in the assignment via the course's Moodle page.
</p>
</div>

</div>

<div id="outline-container-2-1-5" class="outline-4">
<h4 id="sec-2-1-5"><span class="section-number-4">2.1.5</span> Command line tools such as curl and wget</h4>
<div class="outline-text-4" id="text-2-1-5">

<p><code>curl</code> (<a href="http://curl.haxx.se/">http://curl.haxx.se/</a>) is a standard tool to download websites via the command line or (through <code>libcurl</code>) programmatically:
</p>


<pre class="example">curl -v -L -H "Host:www.budabe.eu" -H "Accept:application/xhtml+xml,text/html;q=1.0,text/xml;q=0.9" -H "Accept-Language:de" "http://www.budabe.eu/research"
</pre>


<p>
will return the German-language version of the webpage <code>http://www.budabe.eu/research</code>, with preference in XHTML. The following command, in turn, will return the English language representation:
</p>



<pre class="example">curl -v -L -H "Host:www.budabe.eu" -H "Accept:application/xhtml+xml,text/html;q=1.0,text/xml;q=0.9" -H "Accept-Language:en" "http://www.budabe.eu/research"
</pre>


<p>
<code>wget</code> (<a href="http://www.gnu.org/software/wget/">http://www.gnu.org/software/wget/</a>) has similar functionalities, though more targeted towards web crawling.
</p>

</div>

</div>

<div id="outline-container-2-1-6" class="outline-4">
<h4 id="sec-2-1-6"><span class="section-number-4">2.1.6</span> Encryption and caching</h4>
<div class="outline-text-4" id="text-2-1-6">

<p>Because of its statelessness HTTP is easy to combine with encryption and caching. For encryption the by far most frequent way is HTTP over Secure Sockets Layer (SSL) or Transport Layer Security (TLS). From the perspective of the HTTP protocol this encryption is transparent.
</p>
<p>
For caching, HTTP foresees a set of explicit HTTP headers for this purpose:
</p>
<ul>
<li><code>Last-Modified</code>: Indicates when the resource was last changed. This is typically retrieved with a cheap <code>HEAD</code> request. If <code>Last-Modified</code> is newer than the latest cached version, the cache should be updated accordingly
</li>
<li><code>ETag</code>: A response header to enable cache validation
</li>
</ul>


<p>
The details of cache handling are beyond this script, cf. {Fielding:1999ub}, chapter 13 for all the details. There are a number of Open Source and proprietary caching solution out there including Squid (<a href="http://www.squid-cache.org/">http://www.squid-cache.org/</a>), Varnish Cache (<a href="https://www.varnish-cache.org/about">https://www.varnish-cache.org/about</a>) and many others. In modern architectures, very often also Non-SQL databases are used for this prupose.
</p>
</div>
</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Design principles for RESTful systems</h3>
<div class="outline-text-3" id="text-2-2">



<p>
RESTful systems are, as the name suggests, systems on Representational State Transfer. This hints at Fielding's key idea in his famous dissertation is to see the entire web as a single monstrous state machine &mdash; "Hypermedia as the engine of application state" &mdash;, operated by "uniform interface between components" ({Fielding:2000vh}, 5.1.5). The web centres on resources &mdash; "any information that can be named" (5.2.1.1) &mdash; that are uniquely identified by URIs. A resource is in principle independent of its concrete representation, e.g. as HTML or pdf. Clients and server can use content negoation to mutually agree on a suitable representation of a resource. Hence, "REST-based architectures communicate primarily through the transfer of representations of resources" (5.3.3). 
</p>
<p>
In this concept application state is "the state that the server needs to maintain between each request for each client" ({Allamaraju:2010ty}, p. 7). References to application state or indeed at time the application state itself is coded into URIs and sent with the representation to link to new application states.
</p>
<p>
A Resource Oriented Architecture (ROA) is "an arrangement of URIs, HTTP, and XML that works like the rest of the Web, and that programmers will enjoy using" ({Richardson:2007td}, chapter 4), the term being coinded as an antithesis to Service Oriented Architectures (SOAs). ROAs embrace RESTful principles and systematize key ideas. 
</p>
<p>
A ROA is characterized by the key tenents of RESTful systems, i.e.:
</p>
<ul>
<li>Addressable: each resource is addresable through a URI
</li>
<li>Stateless: each HTTP request standard for itself. It contains all information that the server needs to process the request (it can change the server's resource state, though)
</li>
<li>Links: Links point to possible new states of this or another application
</li>
<li>Uniform interface, i.e. the HTTP methods (polymorphism of HTTP methods, {Dillon:2007hb})
</li>
</ul>




</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Excursion: Ruby</h2>
<div class="outline-text-2" id="text-3">

<p>More details on Ruby in the Prezi <a href="http://prezi.com/_vwryy7ngvj6/?utm_campaign=share&amp;utm_medium=copy&amp;rc=ex0share">http://prezi.com/_vwryy7ngvj6/?utm_campaign=share&amp;utm_medium=copy&amp;rc=ex0share</a> and online in various tutorials
</p>

</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Programming RESTful Web Services: Client side web services</h2>
<div class="outline-text-2" id="text-4">

<p>Session: <span class="timestamp-wrapper"> <span class="timestamp">2013-10-25 Fri</span></span>
</p>
<p>
In our first session we've learned about the HTTP protocol as the technical underpinning for RESTful Web Services. In fact, on the protocol level RESTful Web Services just operate HTTP request / response pairs, using the full set of HTTP methods. In this second phase we're going into more details on other aspects of the design of RESTful Web Services as well as the "RESTful" philosophy. 
</p>

</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Design of URIs</h3>
<div class="outline-text-3" id="text-4-1">

<p>Maybe the most overlooked aspect of RESTful Web Services is the need for "cool URIs". "A cool URI is one which does not change" ({BernersLee:1998ui}):
</p><blockquote>

<p>It is the the duty of a Webmaster to allocate URIs which you will be able to stand by in 2 years, in 20 years, in 200 years. This needs thought, and organization, and commitment.
</p>
</blockquote>


<p>
Berners-Lee proposes that a good URI must remain stable over time. For this it should leave out of the URIs:
</p><ul>
<li>Author's names
</li>
<li>Subject classifications
</li>
<li>Status information (old, new etc.)
</li>
<li>Access rights
</li>
<li>File name extensions
</li>
<li>Implementation details (e.g. <code>/cgi-bin/</code> or similar)
</li>
</ul>


<p>
Instead, he proposes to use stable information such as the original creation date. 
</p>
<p>
For URIs referring to real-life objects such as persons, {Anonymous:2008vd}, 4.5 proposes to follow three design goals:
</p><ul>
<li>Simplicity
</li>
<li>Stability
</li>
<li>Manageability
</li>
</ul>



</div>

<div id="outline-container-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> URI Templates</h4>
<div class="outline-text-4" id="text-4-1-1">

<p>Remains the question on how to transpose these principles into concrete URIs and how to document the resulting URI patterns. RFC 6570 "URI templates" (<a href="http://tools.ietf.org/html/rfc6570">http://tools.ietf.org/html/rfc6570</a> / {Gregorio:2012vo}) defines a template language to document and automatically fill URI templates. The specification defines four levels of compliance. At its simplest, URI templates define string substitutions (compliance level 1):
</p>



<pre class="example">http://www.budabe.eu/{section}/{subsection}

section := "research"
subsection := "DigitalHumanities"

--&gt;
http://www.budabe.eu/research/DigitalHumanities
</pre>


<p>
If necessary, strings are URI encoded, e.g. <code>http://www.budabe.eu/research/Digital%20Humanities</code> if <code>subsection := Digital Humanities</code>. Variables can occur both at the level of URIs and query parameters.
</p>
<p>
Level 2 adds handling of reserved characters that would otherwise be URI encoded. You achieve this goal by adding a <code>+</code> as the first character of the variable:
</p>


<pre class="example">http://www.budabe.eu/{section}
section := "research/Digital Humanities"
--&gt;
http://www.budabe.eu/research%2FDigital%20Humanities

but

http://www.budabe.eu/{+section}
section := "research/Digital Humanities"
--&gt;
http://www.budabe.eu/research/Digital%20Humanities
</pre>


<p>
Similarly, if the first character is a hash (<code>#</code>), the resulting string contains the hash:
</p>



<pre class="example">http://www.budabe.eu/{#section}
section := "Digital Humanities"
--&gt;
http://www.budabe.eu/#Digital%20Humanities
</pre>


<p>
Level 3 add "multiple variables per expression, each separated by a comma, and add more complex operators for dot-prefixed labels, slash-prefixed path segments, semicolon-prefixed path parameters, and the form-style construction of a query syntax consisting of name=value pairs that are separated by an ampersand character" (RFC 6570, p. 5):
</p>



<pre class="example">http://www.budabe.eu/{+section,subsection}
section := "research"
subsection := "Digital Humanities"
--&gt;
http://www.budabe.eu/research,Digital%20Humanities
</pre>


<p>
Similarly, if the first character is a <code>/</code>, the template is treated as a path (and, in the case of <code>#</code> as an anchor):
</p>



<pre class="example">http://www.budabe.eu{/section,subsection}       
(note that there is no slash behind .eu)
section := "research"
subsection := "Digital Humanities"
--&gt;
http://www.budabe.eu/research/Digital%20Humanities
</pre>


<p>
If a part of the variables are not given for substitution, the corresponding part is just left out:
</p>


<pre class="example">http://www.budabe.eu{/section,subsection}       
section := "research"
--&gt;
http://www.budabe.eu/research

http://www.budabe.eu{/section,subsection}       
subsection := "Digital Humanities"
--&gt;
http://www.budabe.eu/Digital%20Humanities
</pre>


<p>
The same applies if the first character is a <code>?</code> or <code>&amp;</code>, in which case all arguments are treated as query string parameters. 
</p>
<p>
Level 4 adds the ability to slighly modify values during variable substitution by adding a <code>:</code> at the end:
</p>


<pre class="example">http://www.budabe.eu{/section:4}
section := "research"
--&gt;
http://www.budabe.eu/rese
</pre>


<p>
Likewise, a <code>*</code> at the end permits the handling of multiple values in lists or similar:
</p>



<pre class="example">http://www.budabe.eu/{section*}
section := ("research", "Digital Humanities")
--&gt;
http://www.budabe.eu/research,Digital%20Humanities
</pre>


<p>
Pre- and postfix modifiers can be combined:
</p>



<pre class="example">http://www.budabe.eu{/section*}
section := http://www.budabe.eu{/section*}
--&gt; 
http://www.budabe.eu/research/Digital%20Humanities
</pre>


<p>
RFC 6570 also has a semi-official test suite <a href="https://github.com/uri-templates/uritemplate-test">https://github.com/uri-templates/uritemplate-test</a>. The examples given in this test suite help to understand many of the edge cases.
</p>
</div>

</div>

<div id="outline-container-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> The case of the European Legislation Identifier (ELI)</h4>
<div class="outline-text-4" id="text-4-1-2">

<p>The European Legislation Identifier (ELI / <a href="http://register.consilium.europa.eu/pdf/en/12/st13/st13401.en12.pdf">http://register.consilium.europa.eu/pdf/en/12/st13/st13401.en12.pdf</a>, cf. also <a href="http://europa.eu/rapid/pressReleasesAction.do?reference=IP/12/1040&amp;format=HTML&amp;aged=0&amp;language=EN&amp;guiLanguage=en">http://europa.eu/rapid/pressReleasesAction.do?reference=IP/12/1040&amp;format=HTML&amp;aged=0&amp;language=EN&amp;guiLanguage=en</a>), published as a Council Conclusions 13401/12,  is a scheme to express laws through URIs. Every member state can flexibly express their own online resources for legislation, however using common variables that can be used to build concrete URI templates. The following variables are in principle foreseen:
</p>



<pre class="example">{jurisdiction} {agent} {sub-agent} {year} {month} {day } {type} {natural identifier} {level 1…} {point in time} {version} {language}
</pre>


<p>
The semantics of these template components is well defined within the Council Conclusions (cf. p. 9).
</p>
<p>
Concrete URI templates for European Legislation can look like this:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/type}{/year}{/natural_identifier,version,language}
</pre>


<p>
The type of legislation is in this case identified by a language-independent code, e.g. <code>reg</code> for <code>regulation</code> or <code>dir</code> for directive. Likewise, <code>agent</code> can be the code for zero to many actors in the European legislative process, e.g. <code>ep</code> for the European Parliament or <code>consil</code> for the Council of the European Union. <code>year</code> is the year in which the legislation was passed and the natural identifier is typically a running number given to a specific type of legislation. The optional <code>version</code> can identify if this specific act is a corrigendum, e.g. <code>R1</code>. <code>language</code> optionally identifies a language version of an act.
</p>
<p>
So, for the Public Sector Information Directive 2003/98/EC of the European Parliament and of the Council of 17 November 2003 in English the ELI would be as follows:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/type}{/year}{/natural_identifier,version,language}

type := "dir"
year := 2003
natural_identifier := 98
language := "ENG"
--&gt;
http://eur-lex.europa.eu/eli/dir/2003/98/ENG
</pre>


<p>
The third corrigendum of the same act in Spanish has the ELI:
</p>


<pre class="example">http://eur-lex.europa.eu/eli{/type}{/year}{/natural_identifier,version,language}

type := "dir"
year := 2003
natural_identifier := 98
version := "R3"
language := "SPA"
--&gt;
http://eur-lex.europa.eu/eli/dir/2003/98/R3/SPA
</pre>


<p>
ELIs follow a logic of search: individual legal resources have metadata elements such as <code>type</code> or <code>agent</code>, an ELI identifies the resource that corresponds to that combination of metadata. By construction, there is maximally one such resource.
</p>
<p>
This logic, however, generalizes also to URI templates that identify a set of resources, e.g.:
</p>
<p>
All legal resources of a given type in a year with its natural identifier regardless of their creating agent:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/type}{/year}{/natural_identifier,version,language}
</pre>


<p>
All legal resources of a given type in a given year:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/type}{/year}
</pre>


<p>
All legal resources of a given type:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/type}
</pre>


<p>
All legal resources in a given year regardless of its type:
</p>



<pre class="example">http://eur-lex.europa.eu/eli{/year}
</pre>


<p>
And finally all legal resources of a given type from one or more given agents:
</p>


<pre class="example">http://eur-lex.europa.eu/eli{/type}
</pre>


<p>
Note: Previous  drafts of the ELI specification used multiple agents (= authors) in the URI as follows:
</p>


<pre class="example">http://eur-lex.europa.eu/eli{/type}{/agents*}{/year}{/natural_identifier,version,language}

type := "dir"
agent := ("ep", "consil")
year := 2003
natural_identifier := 98
language := "ENG"
--&gt;
http://eur-lex.europa.eu/eli/dir/ep/consil/2003/98/ENG
</pre>


<p>
The third corrigendum of the same act in Spanish had then the ELI:
</p>


<pre class="example">http://eur-lex.europa.eu/eli{/type}{/agents*}{/year}{/natural_identifier,version,language}

type := "dir"
agent := ("ep", "consil")
year := 2003
natural_identifier := 98
version := "R3"
language := "SPA"
--&gt;
http://eur-lex.europa.eu/eli/dir/ep/consil/2003/98/R3/SPA
</pre>


</div>

</div>

<div id="outline-container-4-1-3" class="outline-4">
<h4 id="sec-4-1-3"><span class="section-number-4">4.1.3</span> URITemplates in Ruby</h4>
<div class="outline-text-4" id="text-4-1-3">


<p>
Multiple Ruby libraries exist to handle URI Templates up to level 4. I use here Addressable: <a href="http://addressable.rubyforge.org/">http://addressable.rubyforge.org/</a> and <a href="http://rubyforge.org/projects/addressable/">http://rubyforge.org/projects/addressable/</a>. The API documentation of addressable is available under <a href="http://addressable.rubyforge.org/api/">http://addressable.rubyforge.org/api/</a>
</p>
<p>
Addressable must be installed as a normal Ruby gem:
</p>



<pre class="example">sudo gem install addressable
</pre>


<p>
Addressable is at its source a URI handling library that goes beyond the standard Ruby URI class and includes amongst others URI templates. Using the library works as follows:
</p>


<pre class="example">#Taken from http://addressable.rubyforge.org/api/
require "addressable/uri"

uri = Addressable::URI.parse("http://example.com/path/to/resource/")
uri.scheme
#=&gt; "http"
uri.host
#=&gt; "example.com"
uri.path
#=&gt; "/path/to/resource/"

require "addressable/template"

template = Addressable::Template.new("http://example.com/{-list|+|query}/")
template.expand({
  "query" =&gt; "an example query".split(" ")
})
</pre>


<p>
For ELI URI templates the example according to the old ELI draft looks then like this:
</p>



<pre class="example">require "addressable/template"

template = Addressable::Template.new("http://eur-lex.europa.eu/eli{/type}{/agents*}{/year}{/natural_identifier,version,language}")
uri = template.expand({
"type" =&gt; "dir", "agents" =&gt; ["ep", "consil"], "year" =&gt; 2003, "natural_identifier" =&gt; 98
})
#=&gt; #&lt;Addressable::URI:0x3fea68d21c24 URI:http://eur-lex.europa.eu/eli/dir/ep/consil/2003/98&gt;
uri.to_s
#=&gt; "http://eur-lex.europa.eu/eli/dir/ep/consil/2003/98"
</pre>


<p>
A corresponding example for the Google query API and executed in TextMate 2.0:
</p>
<p>
<a href="#img-google_query_executed_in_textmate.png">img/google_query_executed_in_textmate.png</a>
</p>

</div>

</div>

<div id="outline-container-4-1-4" class="outline-4">
<h4 id="sec-4-1-4"><span class="section-number-4">4.1.4</span> Excursion: Handling URITemplates in Clojure</h4>
<div class="outline-text-4" id="text-4-1-4">


<p>
The URITemplates implementation in Clojure, <code>uritemplates-clj</code> (<a href="https://github.com/mwkuster/uritemplate-clj">https://github.com/mwkuster/uritemplate-clj</a>), that I have developed for this purpose, has an extremely simple interface. It exposes a single method, <code>uritemplate</code>, taking the URI template and a map of values as input and returning the URI with the filled in template:
</p>



<pre class="example">user=&gt; (ns test
  #_=&gt; (:require [uritemplate-clj.core :as templ]))
nil
test=&gt; (templ/uritemplate "http://example.org/abc{/type}{/year}{/natural_identifier,version,language}" {"type" "dir", 
  #_=&gt;                "agent"  ["ep" "consil"], 
  #_=&gt;                "year"  "2003",
  #_=&gt;                "natural_identifier" "98"})
"http://example.org/abc/dir/ep/consil/2003/98"
test=&gt; 
</pre>


</div>
</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> JSON</h3>
<div class="outline-text-3" id="text-4-2">

<p>The JavaScript Object Notation or JSON (=
<a href="http://tools.ietf.org/html/rfc4627">http://tools.ietf.org/html/rfc4627</a>) at its simplest is just a subset
of JavaScript concerning only data. JSON uses UTF-8 and supports the
usual datatypes: "A JSON value MUST be an object, array, number, or
string, or one of the following three literal names: false null true" (2.1). Concretely, the following types exist (description follows RFC 4627):
</p>

<ul>
<li>Number: an integer component that   may be prefixed with an optional minus sign, which may be followed by  a fraction part and/or an exponent part. Octal and hex forms are not allowed.  Leading zeros are not allowed
</li>
<li>String: string begins and ends with  quotation marks.  All Unicode characters may be placed within the   quotation marks except for the characters that must be escaped:   quotation mark, reverse solidus, and the control characters (U+0000   through U+001F). The string is encoded in UTF-8
</li>
<li>Boolean: true or false
</li>
<li>Array: square brackets surrounding zero or more values (or elements).  Elements are separated by commas
</li>
<li>Object: a pair of curly brackets   surrounding zero or more name/value pairs (or members).  A name is a   string.  A single colon comes after each name, separating the name   from the value. 
</li>
<li>null (empty)
</li>
</ul>


<p>
We see many of these in action in the following extract taken from <a href="https://github.com/uri-templates/uritemplate-test/blob/master/extended-tests.json">https://github.com/uri-templates/uritemplate-test/blob/master/extended-tests.json</a>:
</p>



<pre class="example">{
    "Additional Examples 1":{
        "level":4,
        "variables":{
            "id"           : "person",
            "token"        : "12345",
            "fields"       : ["id", "name", "picture"],
            "format"       : "json",
            "q"            : "URI Templates",
            "page"         : "5",
            "lang"         : "en",
            "geocode"      : ["37.76","-122.427"],
            "first_name"   : "John",
            "last.name"    : "Doe", 
            "Some%20Thing" : "foo",
            "number"       : 6,
            "long"         : 37.76,
            "lat"          : -122.427,
            "group_id"     : "12345",
            "query"        : "PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt; SELECT ?book ?who WHERE { ?book dc:creator ?who }",
            "word"         : "drücken",
            "Stra%C3%9Fe"  : "Grüner Weg",
            "random"       : "šöäŸœñê€£¥‡ÑÒÓÔÕÖ×ØÙÚàáâãäåæçÿ",
            "assoc_special_chars"  :
              { "šöäŸœñê€£¥‡ÑÒÓÔÕ" : "Ö×ØÙÚàáâãäåæçÿ" }
        }
}
</pre>


<p>
For many languages and especially for dynamic languages JSON maps directly into the corresponding language structures. In Clojure the internal representation of this objects looks very similar to the JSON original and that's certainly no coincidence:
</p>



<pre class="example">{"Additional Examples 1"
 {"level" 4, "variables" 
   {"random" "šöäŸœñê€£¥‡ÑÒÓÔÕÖ×ØÙÚàáâãäåæçÿ", 
   "last.name" "Doe", 
   "query" "PREFIX dc: &lt;http://purl.org/dc/elements/1.1/&gt; SELECT ?book ?who WHERE { ?book dc:creator ?who }",
   "number" 6, 
   "word" "drücken", 
   "assoc_special_chars" {"šöäŸœñê€£¥‡ÑÒÓÔÕ" "Ö×ØÙÚàáâãäåæçÿ"},
   "lang" "en", 
   "page" "5", 
   "q" "URI Templates", 
   "format" "json", 
   "Stra%C3%9Fe" "Grüner Weg", 
   "token" "12345", 
   "fields" ["id" "name" "picture"], 
   "first_name" "John", 
   "id" "person", 
   "group_id" "12345", 
   "long" 37.76, 
   "geocode" ["37.76" "-122.427"], 
   "lat" -122.427, 
   "Some%20Thing" "foo"
   } 
 }
}
</pre>


<p>
Incidentally, the order of attributes in an object is undefined.
</p>

</div>

<div id="outline-container-4-2-1" class="outline-4">
<h4 id="sec-4-2-1"><span class="section-number-4">4.2.1</span> JSON and Ruby</h4>
<div class="outline-text-4" id="text-4-2-1">

<p>JSON support is part of the Ruby standard library. It is essentionally centred around the two methods <code>parse</code> to parse received JSON structures into Ruby data structures and <code>generate</code> to generate JSON structures from Ruby's data structures:
</p>



<pre class="example">test_obj = {:a =&gt; "a", "b" =&gt; "cd", 1 =&gt; "z", 2 =&gt; [1,2,3,4], 3 =&gt; {"i" =&gt; 7}}

j = JSON::generate(test_obj)
#=&gt; "{\"a\":\"a\",\"b\":\"cd\",\"1\":\"z\",\"2\":[1,2,3,4],\"3\":{\"i\":7}}"

obj = JSON::parse(j)
#=&gt; {"a"=&gt;"a", "b"=&gt;"cd", "1"=&gt;"z", "2"=&gt;[1, 2, 3, 4], "3"=&gt;{"i"=&gt;7}}
</pre>



</div>

</div>

<div id="outline-container-4-2-2" class="outline-4">
<h4 id="sec-4-2-2"><span class="section-number-4">4.2.2</span> Excursion: JSON and Clojure</h4>
<div class="outline-text-4" id="text-4-2-2">

<p>There are a number of Clojure libraries for JSON handling. The one we use here is Cheshire (<a href="https://clojars.org/cheshire">https://clojars.org/cheshire</a>), build on the Open Source Java Jackson library (<a href="http://wiki.fasterxml.com/JacksonHome">http://wiki.fasterxml.com/JacksonHome</a>). It is extremely easy to use:
</p>



<pre class="example">(ns b5
  (:use [cheshire.core]))

(def extended-tests  
 (cheshire.core/parse-stream 
    (clojure.java.io/reader "test/uritemplate_clj/extended-tests.json")))
</pre>


<p>
Similarly, Cheshire can easily map native Clojure maps to JSON:
</p>



<pre class="example">(ns b5
  (:use [cheshire.core]))

(cheshire.core/generate-string {:a  "b", :b 5, "c" [1 2 3 4 5]})
--&gt;
"{\"c\":[1,2,3,4,5],\"a\":\"b\",\"b\":5}"
</pre>


</div>
</div>

</div>

<div id="outline-container-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Assignment</h3>
<div class="outline-text-3" id="text-4-3">

<p>Take at your choice and depending on your language skills one of the websites
</p>
<ul>
<li><a href="http://www.legilux.public.lu/">http://www.legilux.public.lu/</a>  (Luxembourg, in French)
</li>
<li><a href="http://legimobile.fr/">http://legimobile.fr/</a> (France)
</li>
<li><a href="http://www.belgielex.be/">http://www.belgielex.be/</a> (Belgium, in French, Dutch, German and English, do search in "Législation belge", then check for frame source to see the links)
</li>
<li><a href="http://legislation.gov.uk/">http://legislation.gov.uk/</a>  (UK)
</li>
<li><a href="http://www.normattiva.it/ricerca/semplice">http://www.normattiva.it/ricerca/semplice</a> (Italy)
</li>
</ul>


<p>
and define a URI template for it. Test the pattern using the uritemplate-clj library or another URITemplate library of your choice and verify for at least 15 different URIs that the URIs that you generate actually exist.
</p>
<p>
Hand in via the course's Moodle page the:
</p><ul>
<li>URI pattern defined
</li>
<li>script used to test that pattern
</li>
<li>list of at least 15 URIs generated and subsequently tested
</li>
</ul>



</div>

</div>

<div id="outline-container-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> ATOM and related standards</h3>
<div class="outline-text-3" id="text-4-4">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2013-10-26 Sat</span></span>
</p>
<p>
ATOM / RFC 4287 (= <a href="http://www.ietf.org/rfc/rfc4287.txt">http://www.ietf.org/rfc/rfc4287.txt</a>), which was incidentally created by the same person as the URI template specification, is next to RSS the most popular standard for content syndication. It is at the same time much more popular than RSS for machine-to-machine communication:
</p><blockquote>

<p>Atom is an XML-based document format that describes lists of related
information known as "feeds".  Feeds are composed of a number of
items, known as "entries", each with an extensible set of attached
metadata.  For example, each entry has a title.
</p>
<p>
The primary use case that Atom addresses is the syndication of Web
content such as weblogs and news headlines to Web sites as well as
directly to user agents. (RFC 4287 / {Gregorio:Z8RX-4sN})
</p>
</blockquote>


<p>
The following extract is taken directly from the RFC:
</p>



<pre class="example">&lt;feed xmlns="http://www.w3.org/2005/Atom"&gt;
 &lt;title&gt;Example Feed&lt;/title&gt;
 &lt;link href="http://example.org/"/&gt;
 &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
 &lt;author&gt;
  &lt;name&gt;John Doe&lt;/name&gt;
 &lt;/author&gt;
 &lt;id&gt;urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6&lt;/id&gt;

 &lt;entry&gt;
  &lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
  &lt;link href="http://example.org/2003/12/13/atom03"/&gt;
  &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
  &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
  &lt;summary&gt;Some text.&lt;/summary&gt;
 &lt;/entry&gt;
&lt;/feed&gt;
</pre>


<p>
ATOM feeds exist for many blogs, often alongside feeds in RSS. For further examples we will use  <a href="http://planet.clojure.in/atom.xml">http://planet.clojure.in/atom.xml</a>, but we could have used any number of other blogs.
</p>



<pre class="example">curl http://planet.clojure.in/atom.xml | less
--&gt;

&lt;feed xmlns="http://www.w3.org/2005/Atom"&gt;
  &lt;title&gt;Planet Clojure&lt;/title&gt;
  &lt;link rel="self" href="http://planet.clojure.in/atom.xml"/&gt;
  &lt;link href="http://planet.clojure.in/"/&gt;
  &lt;id&gt;http://planet.clojure.in/atom.xml&lt;/id&gt;
  &lt;updated&gt;2012-10-14T10:15:44+00:00&lt;/updated&gt;
  &lt;generator uri="http://www.planetplanet.org/"&gt;http://intertwingly.net/code/venus/&lt;/generator&gt;
  &lt;entry&gt;
    &lt;title type="html"&gt;Presentation: Distributed Apps: The Joys of Testing and Debugging&lt;/title&gt;
    &lt;link href="http://www.infoq.com/presentations/Clojure-Stack-Trace"/&gt;
    &lt;id&gt;http://www.infoq.com/presentations/Clojure-Stack-Trace&lt;/id&gt;
    &lt;updated&gt;2012-10-12T22:40:00+00:00&lt;/updated&gt;
    &lt;content type="html"&gt;Chris Houser discusses stack traces in Clojure and introduces a library for investigating activity across multiple threads and servers, plus a technique for reproducing race conditions. &amp;lt;i&amp;gt;By Chris Houser&amp;lt;/i&amp;gt;&lt;/content&gt;
    &lt;author&gt;
            &lt;name&gt;Clojure at InfoQ&lt;/name&gt;
            &lt;uri&gt;http://pipes.yahoo.com/pipes/pipe.info?_id=be83c0b5b0d92b259682cb8021e14d2a&lt;/uri&gt;
    &lt;/author&gt;
    &lt;source&gt;
            &lt;title type="html"&gt;InfoQ Clojure-related materials&lt;/title&gt;
            &lt;subtitle type="html"&gt;Pipes Output&lt;/subtitle&gt;
            &lt;link rel="self" href="http://pipes.yahoo.com/pipes/pipe.run?_id=be83c0b5b0d92b259682cb8021e14d2a&amp;amp;_render=rss"/&gt;
            &lt;id&gt;http://pipes.yahoo.com/pipes/pipe.info?_id=be83c0b5b0d92b259682cb8021e14d2a&lt;/id&gt;
    &lt;/source&gt;
  &lt;/entry&gt;
  &lt;entry&gt;
        [...]
   &lt;/entry&gt;
   [...]
&lt;/feed&gt;
</pre>


<p>
ATOM uses the namespace <code>http://www.w3.org/2005/Atom</code>. Some information is provided on the Feed level, notably the feed's title, an identifier (<code>id</code>), a link to the Atom feed itself (<code>link</code> with rel="self") and possibly to its website and, most crucially, the last update data <code>updated</code> that allows a feed reader to decide if it needs to check for added or updated entries without downloading everything. The real content is then inside the individual <code>entry</code> elements, bringing the entry <code>title</code>, a link to the corresponding web page, again the last <code>updated</code> timestamp for this entry and a summary (<code>content</code>), in this case formatted in basic HTML. Planet Clojure is special in that it is a feed of feeds that aggregates entries from a lot of smaller blogs. For this reason, it indicates the source of that information, together with links and ids.
</p>
<p>
ATOM is in this paradigmatic for RESTful design. It is transported via HTTP, is both machine and (with suitable readers) human readable and provides links to further pages that the reader, whether a machien or a human, can follow.
</p>

</div>

<div id="outline-container-4-4-1" class="outline-4">
<h4 id="sec-4-4-1"><span class="section-number-4">4.4.1</span> Ruby and ATOM</h4>
<div class="outline-text-4" id="text-4-4-1">

<p>A number of ATOM and RSS libraries exist for Ruby. For the purpose of this course we use the Feedzirra library (<a href="https://www.ruby-toolbox.com/projects/feedzirra">https://www.ruby-toolbox.com/projects/feedzirra</a>, documentation <a href="http://rubydoc.info/gems/feedzirra/0.2.1/frames">http://rubydoc.info/gems/feedzirra/0.2.1/frames</a>). Feedzirra is a library building on the Nokogiri XML library to handle a number of feed formats.
</p>



<pre class="example">sudo gem1.9 install feedzirra
</pre>



<pre class="example">require 'feedzirra'

# fetching a single feed
feed = Feedzirra::Feed.fetch_and_parse("http://ilovemyburger.blogspot.com/feeds/posts/default")
#"the quest for the best burger in Luxembourg"
feed.entries.each { |e| puts e.title}
#Outputs a lot of titles

entry_urls = feed.entries.collect { |e| e.url}
#Returns list of URLs
entry_urls = feed.entries.collect { |e| e.title.sanitized}
#Returns list of sanitized URLs
</pre>


<p>
The library also permits to refetch the Feed with only updated entries:
</p>


<pre class="example">updated_feed = Feedzirra::Feed.update(feed)
</pre>



</div>

</div>

<div id="outline-container-4-4-2" class="outline-4">
<h4 id="sec-4-4-2"><span class="section-number-4">4.4.2</span> Excursion: Clojure, Rome and <code>clj-rome</code></h4>
<div class="outline-text-4" id="text-4-4-2">

<p>"ROME is a set of RSS and Atom Utilities for Java that is open source under the Apache 2.0 license" (<a href="https://rometools.jira.com/wiki/display/ROME/Home">https://rometools.jira.com/wiki/display/ROME/Home</a>). It is one of the most popular libraries for handling of (not only) ATOM in the Java world. <code>clj-rome</code> (<a href="https://clojars.org/clj-rome">https://clojars.org/clj-rome</a> / <a href="https://github.com/ngrunwald/clj-rome">https://github.com/ngrunwald/clj-rome</a>) is a Clojure wrapper to the ROME library:
</p>



<pre class="example">user=&gt; (ns b5 
  #_=&gt; (:require [clj-rome.reader :as rr]))
nil
b5=&gt; (def feed (rr/build-feed "http://planet.clojure.in/atom.xml"))
#'b5/feed
b5=&gt; (keys feed)
(:foreign-markup :published-date :entries :preserving-wire-feed? :copyright :link :contributors :author :supported-feed-types :feed-type :image :language :title :uri :categories :original :modules :interface :links :encoding :authors :title-ex :description :description-ex)
b5=&gt; (count (:entries feed))
40
b5=&gt; (map #(:title %) (:entries feed))
("Presentation: Distributed Apps: The Joys of Testing and Debugging" "Rich Hickey - Podcast Episode 019" "\"Concretely, a Graph is just a Clojure map of functions that can depend on the outputs of other...\"" "Google Common Lisp Style Guide" "Clojure/ClojureScript: One Language to Rule the Web" "No such pipe, or this pipe has been deleted" "codeq" "Writing Datomic in Clojure" "Announcing a new Clojure documentation project" "Stuart Sierra - Podcast Episode 018" "Clojure: Refactoring From Thread Last (-&amp;gt;&amp;gt;) To Thread First (-&amp;gt;)" "Versatile into" "Top 20 Web Frameworks for the JVM" "Replacing Common Code With clojure.set Function Calls" "Clojure: Stages of Enlightenment." "Clojure Gazette 1.23" "Memobot" "All ideas are old ideas" "Announcing Langohr documentation guides" "Creating a glow effect" "clojure: lein tar" "Applying DRY to Editing" "Jay Fields' Thoughts: Clojure: Avoiding Anonymous Functions" "Does Scala as a FP Language Suffer From Its OO Syntax?" "No such pipe, or this pipe has been deleted" "Clojure: Avoiding Anonymous Functions" "HalBuilder 2.0.1 Progress" "More Core.logic" "Prismatic's \"Graph\" at Strange Loop" "Clojure Koans" "Image filtering" "Configuration Files in Clojure" "Functional thinking: Tons of transformations" "Functional thinking: Tons of transformations" "A Crash Course on CTCO" "Ecosystems Are Overrated" "I tried using Twitter Bootstrap this morning. Really nice way to support mobile devices." "Clojure Macro: defn-curried" "Clojure Gazette 1.22" "Some core.logic graph code")
b5=&gt; (first (:entries feed))
{:enclosures [], :foreign-markup [], :wire-entry nil, :published-date nil, :link "http://www.infoq.com/presentations/Clojure-Stack-Trace", :contributors [], :author "Clojure at InfoQ", :title "Presentation: Distributed Apps: The Joys of Testing and Debugging", :uri "http://www.infoq.com/presentations/Clojure-Stack-Trace", :updated-date #inst "2012-10-12T22:40:00.000-00:00", :categories [], :modules [{:subject nil, :creator "Clojure at InfoQ", :date nil, :identifier nil, :formats [], :subjects [], :creators ["Clojure at InfoQ"], :types [], :contributors [], :coverages [], :contributor nil, :language nil, :title nil, :uri "http://purl.org/dc/elements/1.1/", :identifiers [], :rights nil, :rights-list [], :coverage nil, :type nil, :interface com.sun.syndication.feed.module.DCModule, :sources [], :dates [], :format nil, :publishers [], :relations [], :descriptions [], :languages [], :source nil, :relation nil, :titles [], :publisher nil, :description nil}], :interface com.sun.syndication.feed.synd.SyndEntry, :links [{:href "http://www.infoq.com/presentations/Clojure-Stack-Trace", :length 0, :title nil, :type nil, :rel "alternate", :hreflang nil}], :authors [{:name "Clojure at InfoQ", :uri "http://pipes.yahoo.com/pipes/pipe.info?_id=be83c0b5b0d92b259682cb8021e14d2a", :email nil, :modules []}], :title-ex {:type "html", :interface com.sun.syndication.feed.synd.SyndContent, :mode nil, :value "Presentation: Distributed Apps: The Joys of Testing and Debugging"}, :description nil, :contents [{:type "html", :interface com.sun.syndication.feed.synd.SyndContent, :mode nil, :value "Chris Houser discusses stack traces in Clojure and introduces a library for investigating activity across multiple threads and servers, plus a technique for reproducing race conditions. &lt;i&gt;By Chris Houser&lt;/i&gt;"}]}
b5=&gt; 
</pre>


<p>
In these examples Clojure returns as usual a map that can be manipulated with the usual higher-order functions. <code>:entries</code> then contains a sequence of maps with the data for the individual entries.
</p>
</div>
</div>

</div>

<div id="outline-container-4-5" class="outline-3">
<h3 id="sec-4-5"><span class="section-number-3">4.5</span> Ruby Libraries for client-side RESTful web services</h3>
<div class="outline-text-3" id="text-4-5">

<p>Ruby comes prepackaged with most libraries that are needed for running client-side RESTful webservices. The main involved packages are <code>net/http</code> and <code>uri</code>, the latter potentially replaced by the <code>addressable</code> gem. Of these <code>net/http</code> and <code>uri</code> are by far the most commonly used libraries.
</p>



<pre class="example">require 'net/http'
resp = Net::HTTP.get_response(URI("http://www.dradio.de/"))
#&lt;Net::HTTPOK 200 OK readbody=true&gt;
resp.code
#"200"
resp.body
#A lot of HTML
</pre>


<p>
The library offers a number of convenience functions such as <code>Net::HTTP.get_print</code> (directly outputs the result to stdout) and <code>Net::HTTP.get</code> (returns the result as a string). For most control it is advisable to inspect the result, though.
</p>
<p>
The library has support for the other HTTP methods just as well:
</p>
<ul>
<li><code>head</code>
</li>
<li><code>post</code> and <code>post_form</code>
</li>
<li><code>delete</code>
</li>
</ul>


<p>
Sending <code>PUT</code> is a bit more complicated:
</p>



<pre class="example">require 'net/http'

port = 8080
host = "www.example.com"
path = "/example/path"

req = Net::HTTP::Put.new(path, initheader = { 'Content-Type' =&gt; 'text/plain'})
req.body = "some text"
response = Net::HTTP.new(host, port).start {|http| http.request(req) }
</pre>


<p>
The same logic can if needed also be used for all other HTTP methods.
</p>
<p>
All methods in their full form can take http headers:
</p>



<pre class="example">require 'net/http'

req = Net::HTTP::Get.new("/", initheader = {"Accept-Language" =&gt; "de"})
resp = Net::HTTP.new("www.google.com", 80).start { |http| http.request(req)}
#Returns a 302 with a redirect to www.google.de
</pre>


<p>
The library also has full proxy support.
</p>
</div>

</div>

<div id="outline-container-4-6" class="outline-3">
<h3 id="sec-4-6"><span class="section-number-3">4.6</span> Libraries for RESTful web services for Java and Clojure</h3>
<div class="outline-text-3" id="text-4-6">


<p>
Session <span class="timestamp-wrapper"> <span class="timestamp">2012-10-20 Sat</span></span>
</p><ul>
<li>Popular JVM libraries for RESTful web services
</li>
<li>Client-side programming
<ul>
<li>Apache HttpComponents
</li>
<li>clj-http as wrapper for HttpComponents
</li>
</ul>

</li>
<li>Programming popular RESTful Web-Service Interfaces by  Google and Amazon in Clojure
</li>
</ul>


<p>
RESTful web services are easy to use with most modern http libraries. For client-side Clojure the most common solution is <code>clj-http</code> (<a href="https://clojars.org/clj-http">https://clojars.org/clj-http</a> / <a href="https://github.com/dakrone/clj-http/">https://github.com/dakrone/clj-http/</a>) which in turn is based on the poplular Apache HttpComponents libraries.
</p>
<p>
Using <code>clj-http</code> is straightforward:
</p>



<pre class="example">(ns b5
  (:require [clj-http.client :as client]))
(client/get "http://www.dradio.de")
</pre>


<p>
The return value comes as a standard Clojure map:
</p>



<pre class="example">{
:cookies {"NSC_esbejp_esbejp" {:discard true, :path "/", :value "ffffffffda4d535d45525d5f4f58455e445a4a423660", :version 0}}, :trace-redirects ["http://www.dradio.de"], :request-time 8894, :status 200, 
[...]
}
</pre>


<p>
<code>clj-http</code> supports all standard http operations.
</p>
<p>
In combination with URITemplates it is possible to run gets:
</p>



<pre class="example">(use 'uritemplate-clj.core)
(def google-template "http://www.google.com//#hl={language}&amp;q={query}")
(map #(:status (client/get (uritemplate google-template %)))
[{"language" "de", "query" "restful web services"}, {"language" "de", "query" "uritemplate"}])
</pre>


</div>

</div>

<div id="outline-container-4-7" class="outline-3">
<h3 id="sec-4-7"><span class="section-number-3">4.7</span> Web Services the Google way</h3>
<div class="outline-text-3" id="text-4-7">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2013-11-08 Fri</span></span>
</p>
<p>
Google offers a elegant, well-documented and powerful RESTful interfaces to its services. We will use it here to illustrate key RESTful principles in practice. This means no endorsement of any kind either by or for Google, with which the author has no affiliation.
</p>
<p>
The web service we are specifically using here is the Calendar API. We will see how to read, create, update and delete entries in a Google calendar.
</p>

</div>

<div id="outline-container-4-7-1" class="outline-4">
<h4 id="sec-4-7-1"><span class="section-number-4">4.7.1</span> Account and authentication</h4>
<div class="outline-text-4" id="text-4-7-1">

<p>In a first stage you need to create a test account that is associated ot an email address (not necessarily a GMail account, though), obviously coupled to a password. With this we can look into the Google Console at <a href="https://code.google.com/apis/console">https://code.google.com/apis/console</a>:
</p>

<div class="figure">
<p><img src="./img/google_console.png"  alt="./img/google_console.png" /></p>
<p>Google API console</p>
</div>

<p>
After agreeing to various terms of use and activating the Calendar API
a user is free to use the service. Finally you can access the API key, a long machine generated unique identifier. Then you can authorize API Access that (amongst others) defines a product name, e.g. worms_calendar. Details of that process are described in <a href="https://developers.google.com/google-apps/calendar/firstapp">https://developers.google.com/google-apps/calendar/firstapp</a> and <a href="https://developers.google.com/google-apps/calendar/auth">https://developers.google.com/google-apps/calendar/auth</a>.
</p>
<p>
Authentication APIs are defined in <a href="https://developers.google.com/accounts/docs/GettingStarted#OAuth">https://developers.google.com/accounts/docs/GettingStarted#OAuth</a> and <a href="https://developers.google.com/console/help/?hl=de#UsingKeys">https://developers.google.com/console/help/?hl=de#UsingKeys</a>. You can interactively test it out using <a href="https://developers.google.com/oauthplayground/?hl=de">https://developers.google.com/oauthplayground/?hl=de</a>. This way you can also access the relevant access tokens.
</p>



<pre class="example">curl -H "Authorization: OAuth ya29.AHES6ZTUrYlO37e8qKFpKVPsCd-4Vd52sFtpR3MSeYB9Php1DZEr" https://www.googleapis.com/calendar/v3/users/me/calendarList
</pre>



<pre class="example">(client/get "https://www.googleapis.com/calendar/v3/users/me/calendarList" {:headers {"Authorization" "OAuth ya29.AHES6ZTUrYlO37e8qKFpKVPsCd-4Vd52sFtpR3MSeYB9Php1DZEr"}})
</pre>


<p>
returns a map. The body is encoded in JSON that we can parse with
Cheshire.
</p>
<p>
The same in Ruby:
</p>



<pre class="example">require 'net/http'
require 'json'

oauth_access_token = "ya29.AHES6ZSut6nn_NOLgfrnOJ2HueUGgyO0iE5pLPH7Cco6nw"

req = Net::HTTP::Get.new("/calendar/v3/users/me/calendarList", initheader = {"Authorization" =&gt; "OAuth #{oauth_access_token}"})
http = Net::HTTP.new("www.googleapis.com", 443)
http.use_ssl = true
http.verify_mode = OpenSSL::SSL::VERIFY_NONE
resp = http.request(req)

if resp.code == "200" then
  calendar_list = JSON::parse(resp.body)
  calendar_list["items"].each { |item| puts item["summary"]}
  #Web Services
  #Privat
else
  raise "Habe den Code #{resp.code} vom Server erhalten"
end
</pre>


</div>

</div>

<div id="outline-container-4-7-2" class="outline-4">
<h4 id="sec-4-7-2"><span class="section-number-4">4.7.2</span> Accessing the API</h4>
<div class="outline-text-4" id="text-4-7-2">

<p>I assume that we've obtained via OAuth2, e.g. using the OAuth 2.0 Playground, a valid access token.
</p>



<pre class="example">(def calender-list (client/get "https://www.googleapis.com/calendar/v3/users/me/calendarList" {:headers {"Authorization" "OAuth ya29.AHES6ZTUrYlO37e8qKFpKVPsCd-4Vd52sFtpR3MSeYB9Php1DZEr"}}))
(cheshire.core/parse-string (:body calender-list))
--&gt;
{"kind" "calendar#calendarList", "etag" "\"940AbKLY6Usoo_WM4FY1utLF0hE/e3lCLkYVmdQwpp-Hfz7EeWMNxPA\"", "items" [{"defaultReminders" [{"method" "popup", "minutes" 30}], "foregroundColor" "#000000", "summary" "Web Services", "kind" "calendar#calendarListEntry", "etag" "\"940AbKLY6Usoo_WM4FY1utLF0hE/rr4G0y99XbqGdzSe2AOgZd0x12s\"", "backgroundColor" "#d06b64", "location" "Worms", "timeZone" "Europe/Berlin", "accessRole" "owner", "id" "XXXXX@googlemail.com", "colorId" "2"} {"foregroundColor" "#000000", "summary" "Privat", "kind" "calendar#calendarListEntry", "etag" "\"940AbKLY6Usoo_WM4FY1utLF0hE/16xw2sMaLL8vMyKzEGcRcZFPZBE\"", "backgroundColor" "#f691b2", "location" "Worms", "timeZone" "Europe/Berlin", "accessRole" "owner", "id" "u2nkrgh7m4hqvofv2nfn9jgnb8@group.calendar.google.com", "description" "Privater Kalender", "colorId" "22"}]}
</pre>


<p>
or in Ruby
</p>



<pre class="example">#...
calendar_list = JSON::parse(resp.body)
puts calendar_list
</pre>


<p>
We can then process the return value using standard Clojure operations:
</p>


<pre class="example">b5&gt; (map #(get % "id")  (get (cheshire.core/parse-string (:body (client/get "https://www.googleapis.com/calendar/v3/users/me/calendarList" {:headers {"Authorization" "OAuth ya29.AHES6ZTn3crVvDHPVBldT2yXaec1hJqk9dsFeEW_oYs"}})              )) "items"))
("XXXXX@googlemail.com" "u2nkrgh7m4hqvofv2nfn9jgnb8@group.calendar.google.com")
b5&gt; 
</pre>


<p>
or in Ruby
</p>



<pre class="example">req = Net::HTTP::Get.new("/calendar/v3/users/me/calendarList", initheader = {"Authorization" =&gt; "OAuth ya29.AHES6ZQpWRLZV_4MpKdILjJuNv7sqeF1xOn4MwQDwxBuZbnTsJVk"})
http = Net::HTTP.new("www.googleapis.com", 443)
http.use_ssl = true
resp = http.request(req)

calendar_list = JSON::parse(resp.body)
calendar_list["items"].collect { |item| item["id"] }
#["XXXXX@googlemail.com", "u2nkrgh7m4hqvofv2nfn9jgnb8@group.calendar.google.com"]
</pre>



<p>
This information can now be used to attack individual calendars and e.g. read all events stored in them.
</p>
<p>
Details of the calendar API are documented under <a href="https://developers.google.com/google-apps/calendar/">https://developers.google.com/google-apps/calendar/</a>
</p>



<pre class="example">(client/get "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events" {:headers {"Authorization" "OAuth ya29.AHES6ZTn3crVvDHPVBldT2yXaec1hJqk9dsFeEW_oYs"}})

(map #(get % "summary") (get (cheshire.core/parse-string (:body (client/get "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events" {:headers {"Authorization" "OAuth ya29.AHES6ZQ_OFaA6RX0VqilLznX6DJOKGBvCChoFB_Mff8"}}))) "items"))
--&gt;
("Web 3" "Schwimmen gehen" "Essen" "Brief schreiben" "Spazierengehen#" "Essen gehen" "Essen gehen" "Web 3" "test" "test" "ZERRIK URA" "ZERRIK URA" "Test" "Gelibesuchen" "Gelibesuchen" "B5 Nachholtermin" "Mensaessen" "Besprechung" "Test in B5" "Pratikum" "Pratikum heute Nachmittag" "Schwimmen" "Schwimmen" "Essen" "Schlafen" "Test0815" "Test0815" "Test0815" "Test0815" "Test0815" "Test0815" "web3" "Test0815" "Test0815" "Test0815" "Test0815" "Fahrrad" "Test0815" "Fahrrad" "Editierter Titel" "Vorlesung im O206" "Huepfen" "H��rdenlauf" "zweiter eintrag" "Test0815" "Test0815" "web3" "Test Eintrag in Web3" "Neuer Termin" "XYZ&amp;" "New4r" "Test0815" "Wir gehen huepfen" "test")
</pre>


<p>
or with curl:
</p>


<pre class="example">curl -v --header "Authorization: OAuth ya29.AHES6ZSut6nn_NOLgfrnOJ2HueUGgyO0iE5pLPH7Cco6nw" https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events
</pre>


<p>
or in Ruby:
</p>


<pre class="example">require 'addressable/template'
require 'rest_client' #new library

calendar_name = "XXXXX@googlemail.com"
template =
Addressable::Template.new("https://www.googleapis.com/calendar/v3/calendars/{+calendar_name}/events")
uri  = template.expand ({"calendar_name" =&gt; calendar_name})
puts uri

oauth_access_token = "ya29.AHES6ZQpnqFNFQg2u5Y7ZmL4xbJ0uiY15EBWrFf7CXr92Q"
resp = RestClient.get uri.to_s, {"Authorization" =&gt; "OAuth #{oauth_access_token}"}
if resp.code == 200 then
  puts resp.body
else
  raise "Habe den Code #{resp.code} zurueckbekommen"
end
</pre>


<p>
The RestClient gem <a href="http://rubydoc.info/gems/rest-client/1.6.7/frames">http://rubydoc.info/gems/rest-client/1.6.7/frames</a> is an abstraction on top of the <code>net/http</code>
standard library that offers a much more friendly alternative to the
relatively low-level operations of <code>net/http</code>:
</p>



<pre class="example">require 'rest_client'

RestClient.get 'http://example.com/resource'

RestClient.get 'http://example.com/resource', {:params =&gt; {:id =&gt; 50, 'foo' =&gt; 'bar'}}

RestClient.get 'https://user:password@example.com/private/resource', {:accept =&gt; :json}

RestClient.post 'http://example.com/resource', :param1 =&gt; 'one', :nested =&gt; { :param2 =&gt; 'two' }

RestClient.post "http://example.com/resource", { 'x' =&gt; 1 }.to_json, :content_type =&gt; :json, :accept =&gt; :json

RestClient.delete 'http://example.com/resource'

#taken from http://rubydoc.info/gems/rest-client/1.6.7/frames
</pre>


<p>
The same mechanism can then also be used to add new events by sending a suitable JSON request:
</p>



<pre class="example">{"start":{"dateTime":"2012-10-20T10:00:00.000-01:00"},"summary":"B5 Lecture today","location":"A126","attendees":["abc@xy.de"],"end":{"dateTime":"2012-10-20T15:00:00.000-01:00"}}
</pre>


<p>
In Clojure the corresponding code looks like this:
</p>



<pre class="example">(def event (cheshire.core/generate-string {"summary" "B5 Lecture today", "location" "A126", "start"  {"dateTime" "2012-10-20T10:00:00.000-01:00"}, "end" {"dateTime" "2012-10-20T15:00:00.000-01:00"}, "attendees" ["abc@xy.de"]}))

(client/post "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events" {:headers {"Authorization" "OAuth ya29.AHES6ZQ_OFaA6RX0VqilLznX6DJOKGBvCChoFB_Mff8"} :content-type :json :body event}) 
</pre>


<p>
or in Ruby:
</p>



<pre class="example">require 'json'
require 'rest_client'
event = {"summary" =&gt; "B5 Lecture today", "location" =&gt; "A126",
"start" =&gt; {"dateTime" =&gt; "2013-11-08T10:00:00.000-01:00"}, "end" =&gt;
{"dateTime" =&gt; "2013-11-08T15:00:00.000-01:00"}, "attendees" =&gt;
["abc@xy.de"]}

response = RestClient.post "https://www.googleapis.com/calendar/v3/calendars/XXXXXX@googlemail.com/events", event.to_json, {"Authorization" =&gt; "OAuth ya29.AHES6ZT5tdB-B3QCVSBiUuRERt7QMsLu0R0x0OdkpT363A", "Content-Type" =&gt; "application/json"}
JSON::parse(response.body)["id"]
#--&gt; "61t660boqd8cmgsboeqi8792dg"
</pre>




<p>
If successful the method returns a 200 JSON struture repeating the full information about the created entry. Most importantly, it also returns the event id that can afterwards be used to modify the created entry.
</p>



<pre class="example">(get (cheshire.core/parse-string (:body (client/post "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events" {:headers {"Authorization" "OAuth ya29.AHES6ZQ_OFaA6RX0VqilLznX6DJOKGBvCChoFB_Mff8"} :content-type :json :body event}))) "id")
--&gt;
"74bvi6025o76q1ffpalst8ih60"
</pre>


<p>
With this information we can update (= <code>PUT</code>) the event:
</p>


<pre class="example">(def modified-event (cheshire.core/generate-string {"summary" "B5 Lecture today, prolonged", "location" "A126", "start"  {"dateTime" "2012-10-20T10:00:00.000-01:00"}, "end" {"dateTime" "2012-10-20T16:00:00.000-01:00"}, "attendees" ["abc@xy.de"]}))
(client/put "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events/74bvi6025o76q1ffpalst8ih60" {:headers {"Authorization" "OAuth ya29.AHES6ZQ_OFaA6RX0VqilLznX6DJOKGBvCChoFB_Mff8"} :content-type :json :body modified-event})
</pre>


<p>
or in Ruby:
</p>



<pre class="example">require 'json'
require 'rest_client'
require 'addressable/template'

event_new = {"summary" =&gt; "B5 Lecture tomorrow", "location" =&gt; "O103", "start" =&gt; {"dateTime" =&gt; "2013-11-08T10:00:00.000-01:00"}, "end" =&gt; {"dateTime" =&gt; "2013-11-08T15:00:00.000-01:00"}, "attendees" =&gt; ["abc@xy.de"]}


template = Addressable::Template.new "https://www.googleapis.com/calendar/v3/calendars/{+calendar_id}/events/{event_id}"
uri = template.expand({ "calendar_id" =&gt; "XXXXX@googlemail.com", "event_id" =&gt; "61t660boqd8cmgsboeqi8792dg"})
oauth_access_code = "ya29.AHES6ZTDhXSjOULxdJpo46lfewJ8zNg7RxXLLUM6yrjJIeIISROc"
response = RestClient.put uri.to_s, event_new.to_json, :content_type =&gt; :json, "Authorization" =&gt; "OAuth #{oauth_access_code}"
puts response.code
</pre>


<p>
or even delete it again
</p>


<pre class="example">(client/delete "https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events/74bvi6025o76q1ffpalst8ih60" {:headers {"Authorization" "OAuth ya29.AHES6ZQ_OFaA6RX0VqilLznX6DJOKGBvCChoFB_Mff8"}})
--&gt;
{:trace-redirects ["https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events/74bvi6025o76q1ffpalst8ih60"], :request-time 586, :status 204, :headers {"cache-control" "no-cache, no-store, max-age=0, must-revalidate", "pragma" "no-cache", "expires" "Fri, 01 Jan 1990 00:00:00 GMT", "date" "Fri, 19 Oct 2012 17:27:54 GMT", "etag" "\"xuTtQAt8DDsZ3NJgXaKj-AnoGow/W6k8nbDP-T9StSHXQg5D9u2ieE8\"", "server" "GSE", "connection" "close"}, :body nil}
</pre>


<p>
or in Ruby:
</p>


<pre class="example">require 'rest_client'
response = RestClient.delete 'https://www.googleapis.com/calendar/v3/calendars/XXXXX@googlemail.com/events/qeg945oge19n8naea4l2r8unvs', "Authorization" =&gt; "OAuth ya29.AHES6ZTDhXSjOULxdJpo46lfewJ8zNg7RxXLLUM6yrjJIeIISROc"
</pre>



</div>
</div>

</div>

<div id="outline-container-4-8" class="outline-3">
<h3 id="sec-4-8"><span class="section-number-3">4.8</span> OAuth2</h3>
<div class="outline-text-3" id="text-4-8">

<p>The OAuth 2.0 Authorization Framework RFC 6750 (<a href="http://tools.ietf.org/html/rfc6750">http://tools.ietf.org/html/rfc6750</a>) becomes more and more the default standard for RESTful authorization. It is supported by most of the major players including Google, Facebook and Github (most of those that remain use the predecessor standard OAuth 1.0):
</p>



<pre class="example">     +--------+                               +---------------+
     |        |--(A)- Authorization Request -&gt;|   Resource    |
     |        |                               |     Owner     |
     |        |&lt;-(B)-- Authorization Grant ---|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(C)-- Authorization Grant --&gt;| Authorization |
     | Client |                               |     Server    |
     |        |&lt;-(D)----- Access Token -------|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(E)----- Access Token ------&gt;|    Resource   |
     |        |                               |     Server    |
     |        |&lt;-(F)--- Protected Resource ---|               |
     +--------+                               +---------------+
(Source: RFC 6750)
</pre>


<p>
For the purpose of these tests we use a local callback function under <a href="http://localhost:3000/api/facebook-callback">http://localhost:3000/api/facebook-callback</a>.
</p>



<pre class="example">$ curl -v -XGET "https://www.facebook.com/dialog/oauth?client_id=XXX&amp;redirect_uri=http://localhost:3000/api/facebook-callback"
--&gt; redirect to URI, gives code
$curl -v -XGET "https://graph.facebook.com/oauth/access_token?client_id=XXX&amp;client_secret=YYYYYYY&amp;redirect_uri=http://localhost:3000/api/facebook-callback&amp;code=AQA5hjdHIKzV6TsMe-sxFqV8A_xI0pu0I-Xb8AIZusVq9Zgt472OGrjW87FXzlMIk_o6TSNMFCear7gpBsHrRSxGOJCegZm65vEv3Mul7N32m5bVem_tB7Nsz8hFhjjoD5yL76pEB--KaZptJvHyEmtR2O7ROM8i0WZj4ERtp7YB3AFhoQAt-Hacp_r9AB4pFmMGgtiwlUs4q45DbATabgTG"
[...]
access_token=AAADRXLVkRpIBAOVAWRhWUQzITBsLbZCkRUgxxpakh8YJIo1jOiqw5nWp82SSiGRo41TLFarO6StOROjbCBf9RHZBQJCzFaBCRxwsjIYwZDZD&amp;expires=5182940
$ curl -XGET "https://graph.facebook.com/me?access_token=AAADRXLVkRpIBAOVAWRhWUQzITBsLbZCkRUgxxpakh8YJIo1jOiqw5nWp82SSiGRo41TLFarO6StOROjbCBf9RHZBQJCzFaBCRxwsjIYwZDZD"
</pre>


<p>
or for Google OAuth:
</p>



<pre class="example">$curl -v
"https://accounts.google.com/o/oauth2/auth?client_id=XXXXXX&amp;redirect_uri=http://localhost:3000/api/google-callback&amp;response_type=code&amp;scope=https://www.googleapis.com/auth/calendar"
--&gt; Asks user for authorization, gives code
--&gt; Now how to handle callback?
</pre>


<p>
For Ruby Google provides a standard library with OAuth implemented: <a href="https://github.com/google/google-api-ruby-client">https://github.com/google/google-api-ruby-client</a>
</p>
</div>

</div>

<div id="outline-container-4-9" class="outline-3">
<h3 id="sec-4-9"><span class="section-number-3">4.9</span> Assignment</h3>
<div class="outline-text-3" id="text-4-9">


<ol>
<li>Develop a command line application in Clojure that takes as parameter an access token, a mode (create, update, delete) and 
<ul>
<li>for create: a title, a start and an end date, and a list of participants as email addresses
</li>
<li>for update: an event id, a title, a start and an end date, and a list of participants as email addresses
</li>
<li>for delete: an event id

</li>
</ul>

<p>   The application inserts / modifies / deletes the event in the Calendar. To simpliy things you can assume that you always get all parameters in the sequence mentioned above on the command line, e.g.:
</p></li>
</ol>





<pre class="example">ruby google_calendar.rb ACCESS-KEY MODE PARAMETER1 PARAMETER2...
</pre>


<ol>
<li>Enhance the command line application so that it lists all of today's events
</li>
</ol>


<p>
Work in teams of two, but hand in the results individually via the project's Moodle page. Indicate in the comments your team partner.
</p>

</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Server-side REST</h2>
<div class="outline-text-2" id="text-5">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2013-11-09 Sat</span></span>
</p><ul>
<li>Server-side programming 
<ul>
<li>Sinatra, a Ruby web application framework
</li>
</ul>

</li>
</ul>



</div>

<div id="outline-container-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Sinatra</h3>
<div class="outline-text-3" id="text-5-1">

<p>Prezy on Sinatra: <a href="http://prezi.com/nwvj2wrstfro/?utm_campaign=share&amp;utm_medium=copy">http://prezi.com/nwvj2wrstfro/?utm_campaign=share&amp;utm_medium=copy</a>
</p>
</div>

</div>

<div id="outline-container-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> The OAuth2 callback</h3>
<div class="outline-text-3" id="text-5-2">

<p>Above we've seen the first part of an OAuth2 process:
</p>



<pre class="example">$curl -v
"https://accounts.google.com/o/oauth2/auth?client_id=XXXXXX&amp;redirect_uri=http://localhost:3000/api/google-callback&amp;response_type=code&amp;scope=https://www.googleapis.com/auth/calendar"
</pre>


<p>
So, let's implement the callback in Sinatra:
</p>



<pre class="example">require 'sinatra'

get '/login' do
  ...
end

get '/api/google-callback' do
  ...
end
</pre>


<p>
The first call from the browser either redirects to the Google login
page (code 302) or returns a 200 with a suitable website
</p>



<pre class="example">&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Moved Temporarily&lt;/TITLE&gt;
&lt;/HEAD&gt;
&lt;BODY BGCOLOR="#FFFFFF" TEXT="#000000"&gt;
&lt;H1&gt;Moved Temporarily&lt;/H1&gt;
The document has moved &lt;A HREF="https://accounts.google.com/ServiceLogin?service=lso&amp;amp;passive=1209600&amp;amp;continue=https://accounts.google.com/o/oauth2/auth?scope%3Dhttps://www.googleapis.com/auth/calendar%26response_type%3Dcode%26redirect_uri%3Dhttp://localhost:3000/api/google-callback%26client_id%3D885816396662-jl12d9jv94mq0fedljhrnocuh627hlkp.apps.googleusercontent.com%26hl%3Dde%26from_login%3D1%26as%3D-2d9194dbdab4f580&amp;amp;ltmpl=popup&amp;amp;shdf=CoIBCxIRdGhpcmRQYXJ0eUxvZ29VcmwaAAwLEhV0aGlyZFBhcnR5RGlzcGxheU5hbWUaEUdvb2dsZSBEZXZlbG9wZXJzDAsSBmRvbWFpbhoRR29vZ2xlIERldmVsb3BlcnMMCxIVdGhpcmRQYXJ0eURpc3BsYXlUeXBlGgdERUZBVUxUDBIDbHNvIhR6PfGvbfOD6Sn3mGvNlSCTg32tCCgBMhRonpKQUW4FsL78fOvZvp_bKFYrrA&amp;amp;sarp=1&amp;amp;scc=1"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;
&lt;/HTML&gt;
</pre>


<p>
After user approval this returns the authorization code:
</p>
<p>
The authorization code can then be exchanged against the acces token itself. At the pure protocol level this looks like this:
</p>



<pre class="example">POST /o/oauth2/token HTTP/1.1
Host: accounts.google.com
Content-length: 250
content-type: application/x-www-form-urlencoded
user-agent: google-oauth-playground

code=4%2FElED3539swnLWrVwEyYZj9Ug7iMV.wlNc8__DJiEZYKs_1NgQtmWzjwBFhQI&amp;redirect_uri=https%3A%2F%2Fdevelopers.google.com%2Foauthplayground&amp;client_id=407408718192.apps.googleusercontent.com&amp;scope=&amp;client_secret=************&amp;grant_type=authorization_code
</pre>


<p>
This returns a little JSON structure with the access token and related information:
</p>


<pre class="example">{ "access_token" : "ya29.1.AADtN_WN4K_mNR7UYVxfU_a2u_Mtj4X6HkJwD8GkGtq0ol3vJuBiF4ZDQv0m", "token_type" : "Bearer", "expires_in" : 3600 }
</pre>


<p>
Translated into Ruby this is:
</p>



<pre class="example">response = RestClient.post "https://accounts.google.com/o/oauth2/token", {:code =&gt; code, :client_id =&gt; client_id, :client_secret =&gt; client_secret, :redirect_uri =&gt; "http://localhost:4567/api/google-callback", :grant_type =&gt; "authorization_code"}, :content_type =&gt; "application/x-www-form-urlencoded"
</pre>



</div>

</div>

<div id="outline-container-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> The Giant Global Graph: Facebook</h3>
<div class="outline-text-3" id="text-5-3">


<p>
The development uses a Facebook account specifically created for this purpose with the login / email XXXXX@googlemail.com and the username Web Worms.
</p>
<p>
<a href="http://www.facebook.com/web.worms.7?sk=timeline">http://www.facebook.com/web.worms.7?sk=timeline</a>
</p>
<p>
Facebook has a well-known set of objects associated to an entity (person or company). This person can have certain properties such as  name, email address, age etc, can own other objects such as photos and most importantly be linked to other entities ("friends") or objects in general ("likes" or similar). "All of the objects in the Facebook social graph are connected to each other via relationships. Bret Taylor is a fan of the Coca-Cola page, and Bret Taylor and Arjun Banker are friends" (<a href="https://developers.facebook.com/docs/reference/api/">https://developers.facebook.com/docs/reference/api/</a>).
</p>
<p>
In general Facebook constitute a monstrous directed graph in which each entity (node) and relationship can carry properties.
</p>
<p>
Some properties such as <code>id</code>, <code>name</code>, <code>first_name</code>, <code>last_name</code>, <code>link</code>, <code>username</code>, <code>gender</code> and <code>locale</code> are more equal than others in that they are always present:
</p>


<pre class="example">{
   "id": "220439",
   "name": "Bret Taylor",
   "first_name": "Bret",
   "last_name": "Taylor",
   "link": "http://www.facebook.com/btaylor",
   "username": "btaylor",
   "gender": "male",
   "locale": "en_US"
}
</pre>



<p>
It is simple to access public information in machine readable format, concretely JSON, for any user:
</p>


<pre class="example">$ curl https://graph.facebook.com/web.worms.7
{"id":"100004654151051","name":"Web Worms","first_name":"Web","last_name":"Worms","link":"http:\/\/www.facebook.com\/web.worms.7","username":"web.worms.7","gender":"female","locale":"de_DE"}
</pre>


<p>
In fact, all (or almost all) of the Facebook functionality is exposed via RESTful webservices. However, only some of the information is publicly accessible, for the remainder we need a login. Given the right permissions you can then get an access-token to see much more information. However, how to integrate a login programmatically via OAuth is the subject of another session. 
</p>
<p>
For now we can use the Facebook Graph API tool allows to test the environment: <a href="http://developers.facebook.com/tools/explorer?method=GET&amp;path=me?fields=likes.offset(5000).limit(5000)">http://developers.facebook.com/tools/explorer?method=GET&amp;path=me%3Ffields%3Dlikes.offset%285000%29.limit%285000%29</a>
</p>
<p>
<a href="#img-facebook_permissions.png">img/facebook_permissions.png</a>
</p>
<p>
<a href="#img-facebook_graph_api.png">img/facebook_graph_api.png</a>
</p>

<p>
Via the Graph API tool you can easily <code>GET</code> information, <code>POST</code> new entries and in general to everything you can do otherwise with the client.
</p>
</div>

</div>

<div id="outline-container-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> Assignment</h3>
<div class="outline-text-3" id="text-5-4">

<p>Based on the first steps in <a href="https://github.com/mwkuster/budabe-graph">https://github.com/mwkuster/budabe-graph</a>:
</p>
<ul>
<li>Define a FQL query to find a given user and all its friends via the Facebook Graph API Explorer (FQL is documented under <a href="https://developers.facebook.com/docs/reference/fql/">https://developers.facebook.com/docs/reference/fql/</a>)
</li>
<li>Extend budabe-graph.core both for the implementation and tests to handle connections between objects (possibly taking into account the experience with the Facebook query)
</li>
</ul>


</div>

</div>

<div id="outline-container-5-5" class="outline-3">
<h3 id="sec-5-5"><span class="section-number-3">5.5</span> <code>budabe-graph</code></h3>
<div class="outline-text-3" id="text-5-5">

<p>Session: <span class="timestamp-wrapper"> <span class="timestamp">2012-11-17 Sat</span></span>
</p>
<p>
Before going further into Facebook, let us do our first own RESTful web application called <code>budabe-graph</code> that allows to create, update and get information on persons and their links between them.
</p>
<p>
The two key libraries in this space are <code>ring</code> and <code>compojure</code>.
</p>




<pre class="example">(defproject budabe-graph "0.1.0-SNAPSHOT"
  :description "A super-simple social graph application"
  :url "http://example.com/FIXME"
  :license {:name "Eclipse Public License"
            :url "http://www.eclipse.org/legal/epl-v10.html"}
  :dependencies [[org.clojure/clojure "1.4.0"]
                 [compojure "1.1.3"]
                 [ring "1.1.6"]
                 [cheshire "4.0.4"]
                 [clojurewerkz/neocons "1.1.0-beta1"]])
</pre>


<p>
<code>ring</code> (<a href="https://clojars.org/ring">https://clojars.org/ring</a>) self-describes itself as a "Clojure web applications library". Ring offers a number of functionalities, but as its core it defines a set of standards for Clojure structure, low-level handling HTTP requests as well as a means to define handlers for those requests. <code>compojure</code> offers a means to define routes to map concrete URIs and HTTP methods on these handlers. 
</p>
<p>
<code>compojure</code> in turn ensures the rouging of elements:
</p>


<pre class="example">(defroutes main-routes
  (GET "/" [] (json/generate-string (list-users)))
  (POST "/"  request (create-user-handler  (:body request)))
  (PUT "/"  request (update-user-handler  (:body request)))
  (GET "/:username" [username] (get-user-by-username username))
  (route/not-found "Page not found"))
</pre>


<p>
Then the RESTful interface can respond to the usual HTTP methods:
</p>



<pre class="example">$ curl -v -XPOST -d '{"username": "johnsmith", "first_name" : "John", "last_name": "Smith", "gender" : "male", "locale": "US"}' --header "Content-Type: application/json" http://localhost:3000/
$  curl -v -XPOST -d '{"username": "janegreen", "first_name" : "Jane", "last_name": "Green", "gender" : "female", "locale": "US"}' --header "Content-Type: application/json" http://localhost:3000/
$  curl -v -XGET http://localhost:3000/

$ curl -v -XPUT -d '{"username": "johnsmith", "first_name" : "John", "last_name": "Brown", "gender" : "male", "locale": "US"}' --header "Content-Type: application/json" http://localhost:3000/johnsmith
</pre>





</div>

</div>

<div id="outline-container-5-6" class="outline-3">
<h3 id="sec-5-6"><span class="section-number-3">5.6</span> Creating a Facebook application</h3>
<div class="outline-text-3" id="text-5-6">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2012-11-17 Sat</span></span>
</p>
<p>
In order to create a new application that integrates with Facebook, you have to be log  into Facebook and then go to <a href="https://developers.facebook.com/">https://developers.facebook.com/</a> to create a basic application. In a first stage you must register as an application developer, having to give unfortunately also a GSM number (you can delete it afterwards). After some more screens you can choose an application name, here WormsB5, to develop the application:
</p>
<p>
<a href="#img-facebook_screenshot.png">img/facebook_screenshot.png</a>
</p>
<p>
In the end you get the real information:
</p>



<pre class="example">WormsB5
App ID:         YYYYY
App Secret:     XXXX
</pre>


<p>
In a permission screen you can request which permissions the application needs to work. In this case I have requested the same rights as a friend for a number of fields including email:
</p>
<p>
<a href="#img-facebook_permission_tab.png">img/facebook_permission_tab.png</a>
</p>
<p>
"As with any other OAuth-enabled app, to get started you’ll need to acquire an application ID and secret to use for authorization, opt into the developer community, and create an application" ({Russell:2011vv}, p. 272). For this purpose you need the App ID and the App Secret to log in. For this it needs
</p>
<ul>
<li>the application ID
</li>
<li>the application secret
</li>
<li>a callback URL
</li>
</ul>


<p>
that all need to be configure in the Facebook app centre.
</p>
<p>
A Facebook user wanting to use this application then needs to grant it access.
</p>
<p>
The overall flow is described in <img src="http://dragon.ak.fbcdn.net/cfs-ak-ash4/84991/914/165799420225798-/server-side-diagram.png"  alt="http://dragon.ak.fbcdn.net/cfs-ak-ash4/84991/914/165799420225798-/server-side-diagram.png" />
</p>



<pre class="example">$curl "https://graph.facebook.com/oauth/access_token?client_id=XXX&amp;grant_type=client_credentials&amp;redirect_uri=http://localhost:8080/facebook-callback&amp;code=AQBMSgT3RhBbZdpQ0tQo0vJURoYm4SV011MmG5RUfWTXg-LoNxJhUAZ2FxHFm_TAhf_nbhEN2_5fCP9fbla5s2HEDh1JWmMb8yy2aLMWUPwjiTNYoTtUV7FrumEYQ8SEhIuq8mshUbNaHULo2mo45eT_JNOGzWXvfNEuAMZDTdCfjg6gRUS4GqwadLNMzu46WT1BssHn2fSvKGid7kc55PCt&amp;client_secret=YYYY"
</pre>



</div>

</div>

<div id="outline-container-5-7" class="outline-3">
<h3 id="sec-5-7"><span class="section-number-3">5.7</span> Assignment</h3>
<div class="outline-text-3" id="text-5-7">

<p>Build on yesterday's assignment use your query to build up the network of a person (<code>https://graph.facebook.com/me</code>) and his / her friends and other connections (friends, likes&hellip;) in Neo4j. For this purpose either change or enhance the existing RESTful interface to ensure that the objects and connections that you have retrieved from Facebook is loaded as nodes and their relationships into Neo4j.
</p>
<p>
Work in teams of two, but hand in the results individually via the project's Moodle page. Indicate in the comments your team partner.
</p>
</div>

</div>

<div id="outline-container-5-8" class="outline-3">
<h3 id="sec-5-8"><span class="section-number-3">5.8</span> Facebook and graphs</h3>
<div class="outline-text-3" id="text-5-8">

<ul>
<li>Show implementation of assignment
</li>
<li>RDFa to embed information
</li>
</ul>







</div>
</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> The Semantic Web</h2>
<div class="outline-text-2" id="text-6">

<p>Sessions <span class="timestamp-wrapper"> <span class="timestamp">2012-12-14 Fri</span></span> and <span class="timestamp-wrapper"> <span class="timestamp">2012-12-15 Sat</span></span>
</p><ul>
<li>What are Ontologies? Ontologies and Us
</li>
<li>Ontologies and Technology
<ul>
<li>Standards
<ul>
<li>RDF
</li>
<li>RDF-S
</li>
<li>OWL
</li>
<li>SPARQL:
      <a href="http://data.gov.uk/sparql">http://data.gov.uk/sparql</a>
      <a href="http://jena.apache.org/tutorials/sparql.html">http://jena.apache.org/tutorials/sparql.html</a>
      <a href="http://www.cambridgesemantics.com/semantic-university/sparql-by-example#(1)">http://www.cambridgesemantics.com/semantic-university/sparql-by-example#%281%29</a>
</li>
</ul>

</li>
<li>Object identity
</li>
<li>Tools
<ul>
<li>Protégé
</li>
<li>Semantic Stores
</li>
</ul>

</li>
</ul>

</li>
<li>Linked Open Data
</li>
<li>Semantic Web Services
</li>
</ul>


<p>
<a href="http://data.gov.uk/sparql">http://data.gov.uk/sparql</a>
</p>
<p>
cf. presentation stored in Moodle.
</p>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Preparing the Practical Programming Projects</h2>
<div class="outline-text-2" id="text-7">

<p>Sessions <span class="timestamp-wrapper"> <span class="timestamp">2014-01-03 Fri</span></span>
</p>
<p>
cf. <a href="https://moodle.fh-worms.de/moodle/mod/page/view.php?id=28017">https://moodle.fh-worms.de/moodle/mod/page/view.php?id=28017</a>
</p>

</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Web Services and the Semantic Web</h2>
<div class="outline-text-2" id="text-8">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2014-01-03 Fri</span></span>
</p>

</div>

<div id="outline-container-8-1" class="outline-3">
<h3 id="sec-8-1"><span class="section-number-3">8.1</span> RDF Serialization formats</h3>
<div class="outline-text-3" id="text-8-1">

<p>Logically, all RDF is triples of subject, predicate and object, and indeed that is how it is often represtend internally inside triple stores. However, triples can be serialized and exchanged in a variety of different formats. Some of these such as Turtle are very close to the triple philosophy, others need more interpretation.
</p>

</div>

<div id="outline-container-8-1-1" class="outline-4">
<h4 id="sec-8-1-1"><span class="section-number-4">8.1.1</span> Turtle</h4>
<div class="outline-text-4" id="text-8-1-1">

<p>One of the simplest forms to encode semantic information is Turtle. Turtle essentially lists the triples. Individual triples are separated by dots (<code>.</code>), but in order to avoid long lists of full triples those triples that share the same subject and predicateonly list the different objects, separated by ~,~, whereas those only sharing the same subject are  compacted by using <code>;</code>.
</p>



<pre class="example">@prefix owl: &lt;http://www.w3.org/2002/07/owl#&gt; .
@prefix rdf: &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; .
@prefix cdm: &lt;http://publications.europa.eu/ontology/cdm#&gt; .
@prefix cdm-annotation: &lt;http://publications.europa.eu/ontology/annotation#&gt; .
@base &lt;http://www.w3.org/2002/07/owl#&gt; .

&lt;http://example.org/resource/celex/61960CC0002&gt; rdf:type cdm:case-law ,
                                                         cdm:document_cjeu ,
                                                         cdm:opinion_advocate-general ,
                                                         cdm:resource_legal ,
                                                         cdm:work ;
                                                 cdm:resource_legal_number_natural_celex "0002"^^xsd:positiveInteger ;
 cdm:resource_legal_year "1960"^^xsd:gYear .

&lt;http://example.org/resource/celex/61960CC0002.BUL&gt; rdf:type cdm:expression .                                              
</pre>


<p>
The mimetype of Turtle is <code>application/x-turtle</code>, the typical file extension <code>TTL</code> (cf. also above for the treatment in the seabass library).
</p>
</div>

</div>

<div id="outline-container-8-1-2" class="outline-4">
<h4 id="sec-8-1-2"><span class="section-number-4">8.1.2</span> RDF/XML</h4>
<div class="outline-text-4" id="text-8-1-2">

<p>Probably the most frequent pure RDF encoding is <code>RDF/XML</code> which is, as the name suggests, an XML-based serialization format for RDF: 
</p>



<pre class="example">&lt;rdf:RDF xmlns="http://www.w3.org/2002/07/owl#"
     xml:base="http://www.w3.org/2002/07/owl"
     xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
     xmlns:cdm="http://publications.europa.eu/ontology/cdm#"
     xmlns:cdm-annotation="http://publications.europa.eu/ontology/annotation#"
     xmlns:owl="http://www.w3.org/2002/07/owl#"
     xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
     xmlns:skos="http://www.w3.org/2004/02/skos/core#"&gt;
  &lt;cdm:judgement rdf:about="http://example.org/resource/celex/62007CJ0535"&gt;
        &lt;rdf:type rdf:resource="&amp;cdm;document_cjeu"/&gt;
        &lt;rdf:type rdf:resource="&amp;cdm;judgement"/&gt;
        &lt;cdm:resource_legal_number_natural_celex rdf:datatype="&amp;xsd;positiveInteger"&gt;0535&lt;/cdm:resource_legal_number_natural_celex&gt;
        &lt;cdm:resource_legal_year rdf:datatype="&amp;xsd;gYear"&gt;2007&lt;/cdm:resource_legal_year&gt;    
  &lt;/cdm:judgement&gt;

  &lt;cdm:expression rdf:about="http://example.org/resource/celex/62007CJ0535.ITA"&gt;
        &lt;cdm:expression_title rdf:datatype="&amp;xsd;string"&gt;Sentenza della Corte (Seconda Sezione) del 14 ottobre 2010. # Commissione europea contro Repubblica d&amp;apos;Austria. # Inadempimento di uno Stato - Direttive 79/409/CEE e 92/43/CEE - Conservazione degli uccelli selvatici - Designazione erronea e tutela giuridica insufficiente delle zone di protezione speciale. # Causa C-535/07.&lt;/cdm:expression_title&gt;
        &lt;cdm:expression_belongs_to_work rdf:resource="http://example.org/resource/celex/62007CJ0535"/&gt;
        &lt;cdm:expression_uses_language rdf:resource="http://publications.europa.eu/resource/authority/language/ITA"/&gt;
    &lt;/cdm:expression&gt;
&lt;/rdf:RDF&gt;
</pre>


<p>
In all of these cases the subject can also be indicated by the <code>rdf:Description</code> element with an explicit <code>rdf:type</code> that indicates the correct type. This example uses an abbreviation that uses (one of) the types as the class name.
</p>
<p>
The subject is always indicated by the <code>rdf:about</code> attribute, the predicate as the element name (e.g. <code>cdm:expression_title</code>), the object by the <code>rdf:resource</code> attribute. In the case of data properties, <code>rdf:datatype</code> can be used ot indicate the correct datatype.
</p>
<p>
In order to mark up common concepts such as the Italian language in this example, the RDF examples refer to codes defined elsewhere in authority tables.
</p>
</div>

</div>

<div id="outline-container-8-1-3" class="outline-4">
<h4 id="sec-8-1-3"><span class="section-number-4">8.1.3</span> RDFa</h4>
<div class="outline-text-4" id="text-8-1-3">

<p>RDFa is, in the words if the W3C recommendation <a href="http://www.w3.org/TR/rdfa-syntax/">http://www.w3.org/TR/rdfa-syntax/</a>, "Syntax and processing rules for embedding RDF through attributes" into a markup language, virtually always (X)HTML. The same webpage is then both human-readable and machine-readable.
</p>
<p>
RDFa largely operates through attributes that either already exist in HTML or are newly added. In fact, RDFa means "RDF in Attributes".
</p>
<p>
For the <code>property</code> and <code>rel</code> attributes this looks as follows (all examples taken directly from the RDFa 1.1 specification <a href="http://www.w3.org/TR/rdfa-syntax/">http://www.w3.org/TR/rdfa-syntax/</a>):
</p>



<pre class="example">&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;head&gt;
    &lt;title&gt;My home-page&lt;/title&gt;
    &lt;meta property="http://purl.org/dc/terms/creator" content="Mark Birbeck" /&gt;
    &lt;link rel="http://xmlns.com/foaf/0.1/topic" href="http://www.example.com/#us" /&gt;
  &lt;/head&gt;
  &lt;body&gt;...&lt;/body&gt;
&lt;/html&gt;
</pre>


<p>
This means that the data property <code>http://purl.org/dc/terms/creator</code>, in this case defined by the Dublin Core specification, has the value <code>Mark Birbeck</code>. The link to <code>http://www.example.com/#us</code> is to be interpreted as a Friend of a Friend (FOAF) topic <code>http://xmlns.com/foaf/0.1/topic</code>.
</p>
<p>
Just like for Turtle it is possible to define abbreviations through prefixes. The following is exactly equivalent to the previous example:
</p>



<pre class="example">&lt;html
  xmlns="http://www.w3.org/1999/xhtml"
  prefix="foaf: http://xmlns.com/foaf/0.1/
          dc: http://purl.org/dc/terms/"
  &gt;
  &lt;head&gt;
    &lt;title&gt;My home-page&lt;/title&gt;
    &lt;meta property="dc:creator" content="Mark Birbeck" /&gt;
    &lt;link rel="foaf:topic" href="http://www.example.com/#us" /&gt;
  &lt;/head&gt;
  &lt;body&gt;...&lt;/body&gt;
&lt;/html&gt;
</pre>


<p>
In principle, the <code>prefix</code> attribute can be used on any element (though in reality this is rarely used).
</p>
<p>
If the content is already present on the human readable page, it can just be reused and an explicit <code>content</code> attribute is not needed:
</p>



<pre class="example">&lt;html
  xmlns="http://www.w3.org/1999/xhtml"
  prefix="dc: http://purl.org/dc/terms/"
  &gt;
  &lt;head&gt;&lt;title&gt;My Home Page&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1 property="dc:title"&gt;My home-page&lt;/h1&gt;
    &lt;p&gt;Last modified: 16 September 2015&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>


<p>
If necessary, the information on the content can be explicitly typed using the <code>datatype</code> property:
</p>


<pre class="example">&lt;html
  xmlns="http://www.w3.org/1999/xhtml"
  prefix="xsd: http://www.w3.org/2001/XMLSchema#
          dc: http://purl.org/dc/terms/"
  &gt;
  &lt;head&gt;&lt;title&gt;My Home Page&lt;/title&gt;&lt;/head&gt;
  &lt;body&gt;
    &lt;h1 property="dc:title"&gt;My home-page&lt;/h1&gt;
    &lt;p&gt;Last modified: &lt;span property="dc:modified"
            content="2015-09-16T16:00:00-05:00"
            datatype="xsd:dateTime"&gt;16 September 2015&lt;/span&gt;.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre>





<p>
In all these cases the subject of the triples is implicitly the webpage itself. RDFa also permits to indicate explicit information on other subjects using the <code>about</code> property:
</p>



<pre class="example">&lt;html
  xmlns="http://www.w3.org/1999/xhtml"
  prefix="bibo: http://purl.org/ontology/bibo/
          dc: http://purl.org/dc/terms/"
  &gt;
  &lt;head&gt;
    &lt;title&gt;Books by Marco Pierre White&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    I think White's book
    '&lt;span about="urn:ISBN:0091808189" 
           property="dc:title"&gt;Canteen Cuisine&lt;/span&gt;'
    is well worth getting since although it's quite advanced stuff, he
    makes it pretty easy to follow. You might also like
    &lt;span 
     about="urn:ISBN:1596913614" 
     property="dc:description"
     &gt;White's autobiography&lt;/span&gt;.
  &lt;/body&gt;
&lt;/html&gt;
</pre>


<p>
If really needed, <code>rdf:type</code> can be indicated through the <code>typeof</code> attribute.
</p>
<p>
Finally, it is possible to markup also the object of a triple explicitly, indicating in this example that Albert Einstein lived, in terms of the DBpedia ontology, both in the German empire and in Switzerland:
</p>



<pre class="example">&lt;div about="http://dbpedia.org/resource/Albert_Einstein" rel="dbp-owl:residence"&gt;
  &lt;span about="http://dbpedia.org/resource/German_Empire"&gt;&lt;/span&gt;
  &lt;span about="http://dbpedia.org/resource/Switzerland"&gt;&lt;/span&gt;
&lt;/div&gt;
</pre>


<p>
In full, the following attributes are defined in the RDFa recommendation, section 5:
</p>
<ul>
<li>about: a SafeCURIEorCURIEorIRI, used for stating what the data is about (a 'subject' in RDF terminology);
</li>
<li>content: a CDATA string, for supplying machine-readable content for a literal (a 'literal object', in RDF terminology);
</li>
<li>datatype: a TERMorCURIEorAbsIRI representing a datatype, to express the datatype of a literal;
</li>
<li>href (optional): a traditionally navigable IRI for expressing the partner resource of a relationship (a 'resource object', in RDF terminology);
</li>
<li>inlist: An attribute used to indicate that the object associated with a rel or property attribute on the same element is to be added to the list for that predicate. The value of this attribute must be ignored. Presence of this attribute causes a list to be created if it does not already exist.
</li>
<li>prefix: a white space separated list of prefix-name IRI pairs of the form NCName ':' ' '+ xsd:anyURI
</li>
<li>property: a white space separated list of TERMorCURIEorAbsIRIs, used for expressing relationships between a subject and either a resource object if given or some literal text (also a 'predicate');
</li>
<li>rel: a white space separated list of TERMorCURIEorAbsIRIs, used for expressing relationships between two resources ('predicates' in RDF terminology);
</li>
<li>resource: a SafeCURIEorCURIEorIRI for expressing the partner resource of a relationship that is not intended to be navigable (e.g., a 'clickable' link) (also an 'object');
</li>
<li>rev: a white space separated list of TERMorCURIEorAbsIRIs, used for expressing reverse relationships between two resources (also 'predicates');
</li>
<li>src (optional): an IRI for expressing the partner resource of a relationship when the resource is embedded (also a 'resource object');
</li>
<li>typeof: a white space separated list of TERMorCURIEorAbsIRIs that indicate the RDF type(s) to associate with a subject;
</li>
<li>vocab: A IRI that defines the mapping to use when a TERM is referenced in an attribute value. 
</li>
</ul>


<p>
CURIes in this context are "compact URI expressions", essentially abbreviated URIs. 
</p>
</div>
</div>

</div>

<div id="outline-container-8-2" class="outline-3">
<h3 id="sec-8-2"><span class="section-number-3">8.2</span> Exercise: Markup of a web page</h3>
<div class="outline-text-3" id="text-8-2">

<p>Markup a Wikipedia page, e.g. <a href="http://en.wikipedia.org/wiki/The_hobbit">http://en.wikipedia.org/wiki/The_hobbit</a>, with the DBpedia ontology
</p>
<p>
cf. also <a href="http://wiki.dbpedia.org/Ontology?v=194q">http://wiki.dbpedia.org/Ontology?v=194q</a> for the ontology and <a href="http://dbpedia.org/page/The_Hobbit">http://dbpedia.org/page/The_Hobbit</a> for the "solution" of dbpedia
</p>
<p>
<a href="#img-the_hobbit_rdfa.png">img/the_hobbit_rdfa.png</a>
</p>
</div>

</div>

<div id="outline-container-8-3" class="outline-3">
<h3 id="sec-8-3"><span class="section-number-3">8.3</span> SPARQL</h3>
<div class="outline-text-3" id="text-8-3">

<p>Existing tutorials:
</p><ul>
<li><a href="http://jena.apache.org/tutorials/sparql.html">http://jena.apache.org/tutorials/sparql.html</a>
</li>
<li><a href="http://www.cambridgesemantics.com/semantic-university/sparql-by-example#(1)">http://www.cambridgesemantics.com/semantic-university/sparql-by-example#%281%29</a>
</li>
</ul>


<p>
Existing endpoints for example:
</p>
<ul>
<li>British law: <a href="http://openuplabs.tso.co.uk/sparql/gov-legislation">http://openuplabs.tso.co.uk/sparql/gov-legislation</a>
</li>
<li>DBPedia: <a href="http://dbpedia.org/sparql">http://dbpedia.org/sparql</a>
</li>
<li>Open Data EU: <a href="http://open-data.europa.eu/de/linked-data">http://open-data.europa.eu/de/linked-data</a>
</li>
</ul>


</div>

</div>

<div id="outline-container-8-4" class="outline-3">
<h3 id="sec-8-4"><span class="section-number-3">8.4</span> Programming the Semantic Web in Ruby</h3>
<div class="outline-text-3" id="text-8-4">

<p>The main library for handling RDF in Ruby is the Open Source library <code>RDF.rb</code>
(<a href="http://rdf.rubyforge.org/">http://rdf.rubyforge.org/</a>) with a considerable number of satellite
libraries including:
</p>
<ul>
<li>rdf-rdfxml (<a href="http://rubygems.org/gems/rdf-rdfxml">http://rubygems.org/gems/rdf-rdfxml</a>), an RDF/XML reader
  and writer for the RDF.rb library suite
</li>
<li>rdf-xsd (<a href="http://rubygems.org/gems/rdf-xsd">http://rubygems.org/gems/rdf-xsd</a>), adds RDF::Literal
  subclasses for extended XSD datatypes
</li>
<li>rdf-rdfa (<a href="http://rubygems.org/gems/rdf-rdfa">http://rubygems.org/gems/rdf-rdfa</a>), an RDFa reader/writer
  for Ruby using the RDF.rb library suite
</li>
<li>rdf-n3 (<a href="http://rubygems.org/gems/rdf-n3">http://rubygems.org/gems/rdf-n3</a>), an Notation-3
  reader/writer for the RDF.rb library suite
</li>
<li>json-ld (<a href="http://rubygems.org/gems/json-ld">http://rubygems.org/gems/json-ld</a>), parses and serializes
  JSON-LD into RDF 
</li>
<li>sparql-client (<a href="http://rubygems.org/gems/sparql-client">http://rubygems.org/gems/sparql-client</a>), executes
  SPARQL queries and updates against a remote SPARQL 1.0 or 1.1
  endpoint, or against a local repository
</li>
<li>rdf-isomorphic (<a href="http://rubygems.org/gems/rdf-isomorphic">http://rubygems.org/gems/rdf-isomorphic</a>), plugin for
  graph bijections and isomorphic equivalence
</li>
<li>rdf-turtle (<a href="http://rubygems.org/gems/rdf-turtle">http://rubygems.org/gems/rdf-turtle</a>), an Turtle
  reader/writer for the RDF.rb library suite
</li>
<li>rdf-json (<a href="http://rubygems.org/gems/rdf-json">http://rubygems.org/gems/rdf-json</a>), plugin for
  parsing/serializing RDF/JSON data
</li>
<li>sparql (<a href="http://rubygems.org/gems/sparql">http://rubygems.org/gems/sparql</a>), implements SPARQL grammar
  parsing to SPARQL Algebra, SPARQL Algebra processing and includes
  SPARQL Client for accessing remote repositories
</li>
</ul>


<p>
All of these libraries are available as Ruby gems:
</p>



<pre class="example">gem install rdf
gem install rdf-rdfxml
gem install rdf-n3
gem install sparql
gem install rdf-turtle
etc.
</pre>


<p>
Usage is simple:
</p>



<pre class="example">require 'rdf'
require 'sparql'
require 'rdf/turtle'
require 'rdf/rdfxml'

repo = RDF::Repository.new
repo.load("62007CJ0535.rdf", :format =&gt; :rdfxml)
repo.load("61960CC0002.ttl", :format =&gt; :ttl)
repo.load("http://publications.europa.eu/resource/celex/62012CJ0001", 
          options={:headers =&gt; {"Accept" =&gt; "application/rdf+xml;notice=tree"}, :format =&gt; :rdfxml})

#Just for debugging: show the contents of the repository
repo.each_statement { |statement| puts statement }
</pre>



</div>

</div>

<div id="outline-container-8-5" class="outline-3">
<h3 id="sec-8-5"><span class="section-number-3">8.5</span> Programming the Semantic Web in Clojure</h3>
<div class="outline-text-3" id="text-8-5">


<p>
A large number of libraries exist for handling RDF including well-established Open Source Java libraries such as Sesame and Jena. For Clojure, Seabass (<a href="https://clojars.org/seabass">https://clojars.org/seabass</a>) offers a small wrapper around the Jena library, making it easy to treat RDF in Clojure. Similar libraries exist for other platforms.
</p>
<p>
As dependencies you add:
</p>


<pre class="example">[xerces/xercesImpl "2.10.0"] ;; Direct download from Maven central
[seabass "2.0"]
</pre>



<p>
This will also download the Jena libraries which do most of the work.
</p>
<p>
Once seabass is installed, using it is simple: 
</p>
<p>
You <code>build</code> a model, essentially a local database containing <code>seabass.core</code> triples you just load one or more files in one of the possible RDF serialzation formats (cf. below):
</p>


<pre class="example">(def model 
  (build ["src/s12/62007CJ0535.rdf" "RDF/XML"]
         ["src/s12/61960CC0002.ttl" "TTL"]))
</pre>


<p>
In addition, you can also indicate URIs from which these files should be downloaded. You can also integrate data from external SPARQL endpoints using <code>CONSTRUCT</code> queries and the <code>pull</code> command:
</p>




<pre class="example">(def model 
  (build ["src/s12/62007CJ0535.rdf" "RDF/XML"]
         ["src/s12/61960CC0002.ttl" "TTL"]))

;;Query is
;;construct {?institution ?p ?o} {?institution a &lt;http://dbpedia.org/class/yago/InstitutionsOfTheEuropeanUnion&gt; . 
?institution ?p ?o
} LIMIT 10000")
(def model (build ["src/s12/62007CJ0535.rdf" "RDF/XML"]
         ["src/s12/61960CC0002.ttl" "TTL"]
         (pull "construct {?institution ?p ?o} {?institution a &lt;http://dbpedia.org/class/yago/InstitutionsOfTheEuropeanUnion&gt; . 
?institution ?p ?o
} LIMIT 10000" "http://dbpedia.org/sparql")))
</pre>


<p>
You can then execute queries against a model using the <code>bounce</code> function that takes the SPARQL <code>SELECT</code> query as a first parameter and a model as the second, e.g.:
</p>


<pre class="example">(bounce 
"PREFIX cdm: &lt;http://publications.europa.eu/ontology/cdm#&gt; 
select ?expr ?title ?lang
{?work cdm:resource_legal_id_celex \"62007CJ0535\"^^xsd:string .
 ?expr cdm:expression_belongs_to_work ?work .
 ?expr cdm:expression_title ?title .
 ?expr cdm:expression_uses_language ?lang .
 }" model)
</pre>


<p>
The result is returnd as a Clojure map with all the results in the <code>:data</code> field:
</p>


<pre class="example">{:vars (:expr :title :lang), :data ({:lang "http://publications.europa.eu/resource/authority/language/FRA", :title "Arrêt de la Cour (deuxième chambre) du 14 octobre 2010. # Commission européenne contre République d'Autriche. # Manquement d’État - Directives 79/409/CEE et 92/43/CEE - Conservation des oiseaux sauvages - Désignation incorrecte et protection juridique insuffisante des zones de protection spéciale. # Affaire C-535/07.", :expr "http://anycellar.publications.europa.eu/resource/celex/62007CJ0535.FRA"}...)}
</pre>


<p>
You can handle those results like any other Clojure map
</p>


<pre class="example">(filter #(= (:lang %) "http://publications.europa.eu/resource/authority/language/ENG")  (:data (get-titles-by-celex "61960CC0002")))
</pre>




</div>

</div>

<div id="outline-container-8-6" class="outline-3">
<h3 id="sec-8-6"><span class="section-number-3">8.6</span> Excursion: Facebook and RDFa: the Open Graph protocol</h3>
<div class="outline-text-3" id="text-8-6">

<p>Facebook uses RDFa to integrate with external webpages. The Open Graph protocol <a href="http://opengraphprotocol.org/">http://opengraphprotocol.org/</a> / <a href="http://ogp.me/">http://ogp.me/</a> defines a vocabulary that can be used to integrate metadata into a webpage. In fact, this vocabulary is itself defined in RDF and available under <a href="http://ogp.me/ns/ogp.me.ttl">http://ogp.me/ns/ogp.me.ttl</a>. It defines the following core properties ("basic metadata") that should always be present (cited after <a href="http://ogp.me/">http://ogp.me/</a>):
</p>
<ul>
<li><code>og:title</code> - The title of your object as it should appear within the graph, e.g., "The Rock".
</li>
<li><code>og:type</code> - The type of your object, e.g., "video.movie". Depending on the type you specify, other properties may also be required.
</li>
<li><code>og:image</code> - An image URL which should represent your object within the graph.
</li>
<li><code>og:url</code> - The canonical URL of your object that will be used as its permanent ID in the graph, e.g., "<a href="http://www.imdb.com/title/tt0117500/">http://www.imdb.com/title/tt0117500/</a>".
</li>
</ul>


<p>
<code>og</code> stands for <a href="http://ogp.me/ns">http://ogp.me/ns</a>#.
</p>
<p>
This information should be given in metatags in the HTML header, though this is a Facebook restriction, not an RDFa one:
</p>



<pre class="example">&lt;html&gt;
  &lt;head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# book: http://ogp.me/ns/book#"&gt;
    &lt;title&gt;OG Sample Object - Geordnetes Weltbild&lt;/title&gt;

    &lt;meta property="og:title" content="Geordnetes Weltbild" /&gt;
    &lt;meta property="og:image" content="http://www.budabe.de/img/geordnetes_weltbild_cover_1.jpg" /&gt;
    &lt;meta property="og:url" content="http://www.budabe.eu/static/geordnetes_weltbild" /&gt;
    &lt;meta property="og:type" content="book" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
  ...
  &lt;/body&gt;
&lt;/html&gt;
</pre>


<p>
In addition to these mandatory elements the following optional metadata elements are possible for all types of objects:
</p>
<ul>
<li>og:audio - A URL to an audio file to accompany this object.
</li>
<li>og:description - A one to two sentence description of your object.
</li>
<li>og:determiner - The word that appears before this object's title in a sentence. An enum of (a, an, the, "", auto). If auto is chosen, the consumer of your data should chose between "a" or "an". Default is "" (blank).
</li>
<li>og:locale - The locale these tags are marked up in. Of the format language_TERRITORY. Default is en_US.
</li>
<li>og:locale:alternate - An array of other locales this page is available in.
</li>
<li>og:site_name - If your object is part of a larger web site, the name which should be displayed for the overall site. e.g., "IMDb".
</li>
<li>og:video - A URL to a video file that complements this object
</li>
</ul>



<p>
Individual types of objects can and often have more specific metadata in addition to the generic ones. A book for example can have the following metadata elements (namespace <a href="http://ogp.me/ns/book">http://ogp.me/ns/book</a>#):
</p>
<ul>
<li>book:author - profile array - Who wrote this book.
</li>
<li>book:isbn - string - The ISBN
</li>
<li>book:release_date - datetime - The date the book was released.
</li>
<li>book:tag - string array - Tag words associated with this book.
</li>
</ul>


<p>
The following types of objects are predefined (all of them have their own namespaces):
</p><ul>
<li>website
</li>
<li>music with subtypes music.song, music.album, music.playlist and music.radio_station
</li>
<li>video with subtypes video.movie, video.episode, video.tv_show, video.other
</li>
<li>article
</li>
<li>book
</li>
<li>profile
</li>
</ul>


<p>
In addition, Facebook itself defines a number of extensions in the <a href="http://ogp.me/ns/fb">http://ogp.me/ns/fb</a># namespace, notably:
</p><ul>
<li>fb:app_id: the application id in Facebook, e.g. 230196110444178
</li>
<li>fb:admins: one or more ids of Facebook users that can get administrative information on this object, e.g. 100004654151051
</li>
</ul>


<p>
Facebook can then directly use this metadata integrating information on a resource into Facebook itself, e.g. for the "liking" of resources. You can access this information by going through the like button with for the administrator(s) will now contain an additional link to this admin page.
</p>
<p>
<a href="#img-facebook_activities.png">img/facebook_activities.png</a>
</p>
<p>
In the application configuration, e.g. for <a href="https://developers.facebook.com/apps/230196110444178">https://developers.facebook.com/apps/230196110444178</a>, an application can even go beyond this. It can define action types (= object properties in OWL terms) e.g. to rate a book. For this it can either reuse existing object types or even define completely new ones. It can also define new object types (= classes in OWL terms).
</p>
<p>
<a href="#img-app_center_open_graph.png">img/app_center_open_graph.png</a>
</p>
<p>
An application can indicate its intention to publish things on Facebook through the like button:
</p>



<pre class="example">&lt;fb:like href="http://www.goodreads.com/book/show/13010670-programming-clojure" width="280" layout="standard" show_faces="true" action="like" colorscheme="light" font="arial" /&gt;
</pre>



<p>
In all of these cases Facebook extracts metadata in the website to populate the information in Facebook. This metadata is precisely the one encoded in RDFa. To test this integration the company has created a debugger for metadata: <a href="http://developers.facebook.com/tools/debug/og/object">http://developers.facebook.com/tools/debug/og/object</a>. You can use it for example: <a href="http://developers.facebook.com/tools/debug/og/object?q=http://www.goodreads.com/review/show/488396402">http://developers.facebook.com/tools/debug/og/object?q=http%3A%2F%2Fwww.goodreads.com%2Freview%2Fshow%2F488396402</a>. Google has a corresponding tool, <a href="http://www.google.com/webmasters/tools/richsnippets">http://www.google.com/webmasters/tools/richsnippets</a> that also supports the Open Graph Protocol.
</p>
<p>
However, Facebook goes a step further. In the application center a developer can define new RDF objects based on the Open Graph Protocol with new elements inside. What is more, the system then automatically creates a sample website with RDFa data integrated, e.g. <a href="http://samples.ogp.me//199815506812566">http://samples.ogp.me//199815506812566</a> for a sample application on book rating. In other terms, Facebook permits to extend the existing ontology with new properties and classes:
</p>
<p>
<a href="#img-open_graph_new_properties.png">img/open_graph_new_properties.png</a>
</p>
<p>
<a href="#img-open_graph_new_class.png">img/open_graph_new_class.png</a>
</p>

<p>
What is more, the tool automatically generates a sample object, e. g. for book: <a href="https://graph.facebook.com/10151191340470101/">https://graph.facebook.com/10151191340470101/</a>, and instructions on how to call the corresponding web services that an application can use to post its entries directly to a user's timeline:
</p>


<pre class="example">curl -F 'access_token=XXXXX'      -F 'book=http://samples.ogp.me/199815506812566'         'https://graph.facebook.com/me/worms-web:rate'

curl -F 'access_token=XXXX'      -F 'book=https://www.budabe.eu/static/geordnetes_weltbild'         'https://graph.facebook.com/me/worms-web:rate'
</pre>


<p>
With aggregations it is possible to calculate numbers of smaller activities, e.g. this user has heard 200 songs last months.
</p>
<p>
At this stage many of the big players from <a href="http://imdb.com">http://imdb.com</a>, <a href="http://www.amazon.com">http://www.amazon.com</a>, <a href="http://digg.com">http://digg.com</a>, <a href="https://www.spotify.com">https://www.spotify.com</a>, <a href="http://www.goodreads.com/">http://www.goodreads.com/</a> all integrate in this way with Facebook, using the Facebook authentication, sometimes amongst others such as the Twitter or Google authentication.
</p>
<p>
<a href="http://youtu.be/TM-2fNtg7p8">http://youtu.be/TM-2fNtg7p8</a> and <a href="http://youtu.be/__FplazeKvU">http://youtu.be/__FplazeKvU</a> give a good idea on the business reasons that Facebook has to integrate Facebook with all sorts of objects outside it, making effectively a part of Facebook. This specific take on a semantic web of things that monitors a users activities &mdash; books, music, runs, whatever &mdash; is at the same time techically fascinating and obviously disquieting from a privacy point of view.
</p>

</div>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Testing RESTful Web Services</h2>
<div class="outline-text-2" id="text-9">

<p> <span class="timestamp-wrapper"> <span class="timestamp">2014-01-04 Sat</span></span><br/>
</p>
<p>
TODO
</p>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Bibliography</h2>
<div class="outline-text-2" id="text-10">

<p>TODO
</p></div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Excursion: Neo4j: a RESTful Database</h2>
<div class="outline-text-2" id="text-11">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2012-11-02 Fri</span></span>
</p>

</div>

<div id="outline-container-11-1" class="outline-4">
<h4 id="sec-11-1"><span class="section-number-4">11.1</span> What is Neo4j?</h4>
<div class="outline-text-4" id="text-11-1">

<p>The Open Source database Neo4j (<a href="http://www.neo4j.org">http://www.neo4j.org</a>) is an example of the growing segment of NoSQL databases. It is a graph database that centres around two Topic Map {ISOIEC:2002uf} like concepts, nodes and relationships. Nodes and relationships have unique identifiers, but can have arbitrary properties besides. If Neo4j speaks of graphs, it is directed graphs that it thinks of, so each relationship must have a start and an end node. Otherwise, relationships are database objects just like nodes that can be created, updated and deleted, be queried and have properties just like nodes.
</p>
<p>
A graph database assumes that we want to model the world as a directed graph &mdash; {Redmond:2012wd} uses the term "whiteboard-friendly modelling":
</p>
<p>
<a href="#img-neo4j_graph.png">img/neo4j_graph.png</a>
</p>
<p>
Installation of Neo4j is trivial:
</p>
<ol>
<li>Download the latest version from <a href="http://neo4j.org/download/">http://neo4j.org/download/</a>
</li>
<li>Unpack it to a suitable directory
</li>
<li><code>cd</code> to that directory and execute <code>bin/neo4j start</code> or the corresponding command under Windows
</li>
<li>Check with <a href="http://localhost:7474/webadmin">http://localhost:7474/webadmin</a> that the database is up
</li>
</ol>


</div>

</div>

<div id="outline-container-11-1" class="outline-3">
<h3 id="sec-11-1"><span class="section-number-3">11.1</span> Neo4j's admin interface</h3>
<div class="outline-text-3" id="text-11-1">

<p>Neo4j’s admin interface also has one of the more innovative graph UIs that is currently available in an off-the-shelf database.
</p>

<p>
The graph we have just seen can be translated as is into Neo4j, using e.g. the +Node and +Relationship features of the Neo4j data browser that is part of the admin interface:
</p>
<p>
<a href="#img-neo4j_databrowser.png">img/neo4j_databrowser.png</a>
</p>
<p>
The node and its relationships can then also be visualized:
</p>
<p>
And finally queried:
</p>



<pre class="example">START n = node(*)
WHERE has(n.name) and n.name = "B5"
RETURN n;

--&gt; returns Node
</pre>


<p>
Neo4j positions itself for enterprise use and seems to currently see significant uptake:
</p>
<blockquote>

<p>As a robust, scalable and high-performance database, Neo4j is suitable for full enterprise deployment or a subset of the full server can be used in lightweight projects.
It features:
</p><ul>
<li>true ACID transactions
</li>
<li>high availability
</li>
</ul>

<p>. scales to billions of nodes and relationships
</p><ul>
<li>high speed querying through traversals {Neojorg:2012tu}
</li>
</ul>



</blockquote>



</div>

</div>

<div id="outline-container-11-2" class="outline-3">
<h3 id="sec-11-2"><span class="section-number-3">11.2</span> Neo4j's RESTful interface</h3>
<div class="outline-text-3" id="text-11-2">

<p>Like many of the new developments in the NoSQL scene, Neo4j exposes a RESTful interface, though in this specific case Neo4j also has a powerful admin interface that gives access to many of its features, including its query language, Cypher. It is also possible to directly embed Neo4j in an application, though we will not look at this case here. 
</p>
<p>
Already our examples before have given some first impressions of Neo4j's RESTful web service interface:
</p>



<pre class="example">A concrete node: http://localhost:7474/db/data/node/20991

A search for this node: http://localhost:7474/webadmin/#/data/search/20991/ 

A concrete relationship, "Node 1 part-of Node 3": http://localhost:7474/db/data/relationship/2

A search for this relationship: http://localhost:7474/webadmin/#/data/search/rels%3A3/

A query: http://localhost:7474/webadmin/#/data/search/START%20n%20%3D%20node(*)%0AWHERE%20has(n.name)%20and%20n.name%20%3D%20%22B5%22%0ARETURN%20n%3B/
</pre>




<p>
Neo4j is well documented: <a href="http://docs.neo4j.org/chunked/milestone/rest-api.html">http://docs.neo4j.org/chunked/milestone/rest-api.html</a>. Like many other interfaces it uses JSON as data exchange format.
</p>
<p>
These URIs work also programmatically as expected and return a JSON representation of the given node, giving links to related objects:
</p>



<pre class="example">$ curl -XGET http://localhost:7474/db/data/node/20991
--&gt;

{
  "extensions" : {
  },
  "paged_traverse" : "http://localhost:7474/db/data/node/20991/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "outgoing_relationships" : "http://localhost:7474/db/data/node/20991/relationships/out",
  "traverse" : "http://localhost:7474/db/data/node/20991/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/20991/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/20991/properties/{key}",
  "all_relationships" : "http://localhost:7474/db/data/node/20991/relationships/all",
  "self" : "http://localhost:7474/db/data/node/20991",
  "properties" : "http://localhost:7474/db/data/node/20991/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/20991/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/20991/relationships/in",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/20991/relationships/in/{-list|&amp;|types}",
  "create_relationship" : "http://localhost:7474/db/data/node/20991/relationships",
  "data" : {
    "name" : "B5",
    "type" : "Course"
  }
}
</pre>


<p>
or for relationships:
</p>



<pre class="example">$ curl -XGET http://localhost:7474/db/data/relationship/2
{
  "extensions" : {
  },
  "start" : "http://localhost:7474/db/data/node/1",
  "property" : "http://localhost:7474/db/data/relationship/2/properties/{key}",
  "self" : "http://localhost:7474/db/data/relationship/2",
  "properties" : "http://localhost:7474/db/data/relationship/2/properties",
  "type" : "part-of",
  "end" : "http://localhost:7474/db/data/node/3",
  "data" : {
    "link-text" : ":part-of:-&gt;xpointer(/TEI[1]/text[1]/group[1]/text[1]/body[1]/div[1]/sp[1]/ab[1]/text()[1])"
  }
}
</pre>



<p>
In best REST-way the interface exposes links to further representations of related objects (outgoing_relationships, incoming_relationships and all_relationships).
</p>
<p>
Of course, there is not only <code>GET</code>: With <code>PUT</code> you can update properties, though with a slight twist in that you must go against the list of <a href="http://localhost:7474/db/data/node/20991/properties">http://localhost:7474/db/data/node/20991/properties</a>: 
</p>


<pre class="example">$  curl -v -XPUT -H "Accept: application/json" -H "Content-type: application/json"  -d '{"name": "B5-1"}' http://localhost:7474/db/data/node/20991/properties 
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; PUT /db/data/node/20991/properties HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: application/json
&gt; Content-type: application/json
&gt; Content-Length: 16
&gt; 
 upload completely sent off: 16 out of 16 bytes
&lt; HTTP/1.1 204 No Content
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
 Connection #0 to host localhost left intact
 Closing connection #0
$  curl -XGET http://localhost:7474/db/data/node/20991/properties
{
  "name" : "B5-1"
}
</pre>


<p>
As we see in this example, this operation replaces the current properties completely
</p>
<p>
And there's still delete, first on the property level:
</p>


<pre class="example">$ curl -v -XDELETE -H "Accept: application/json" http://localhost:7474/db/data/node/20991/properties 
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; DELETE /db/data/node/20991/properties HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: application/json
&gt; 
&lt; HTTP/1.1 204 No Content
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
 Connection #0 to host localhost left intact
 Closing connection #0
$  curl -XGET http://localhost:7474/db/data/node/20991/properties
$
</pre>


<p>
We can <code>PUT</code> back new properties:
</p>


<pre class="example">$ curl -v -XPUT -H "Accept: application/json" -H "Content-type: application/json"  -d '{"name": "New B5", "participants" : 30}'  http://localhost:7474/db/data/node/20991/properties
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; PUT /db/data/node/20991/properties HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: application/json
&gt; Content-type: application/json
&gt; Content-Length: 39
&gt; 
 upload completely sent off: 39 out of 39 bytes
&lt; HTTP/1.1 204 No Content
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
 Connection #0 to host localhost left intact
 Closing connection #0
$  curl -XGET http://localhost:7474/db/data/node/20991/properties{
  "participants" : 30,
  "name" : "New B5"
}
</pre>


<p>
And also update individual properties:
</p>


<pre class="example">$ curl -v -XPUT -H "Accept: application/json" -H "Content-type: application/json"  -d '"New B5-2"'  http://localhost:7474/db/data/node/20991/properties/name
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; PUT /db/data/node/20991/properties/name HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: application/json
&gt; Content-type: application/json
&gt; Content-Length: 10
&gt; 
 upload completely sent off: 10 out of 10 bytes
&lt; HTTP/1.1 204 No Content
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
 Connection #0 to host localhost left intact
 Closing connection #0
$  curl -XGET http://localhost:7474/db/data/node/20991/properties{
  "participants" : 30,
  "name" : "New B5-2"
}
</pre>


<p>
Which is in itself a comment on the importance of good URI design.
</p>
<p>
And finally we can <code>Post</code> a new node complete with properties:
</p>


<pre class="example">$ curl -v -XPOST -H "Accept: application/json" -H "Content-type: application/json"  -d '{"name": "That is it"}'  http://localhost:7474/db/data/node/
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; POST /db/data/node/ HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: application/json
&gt; Content-type: application/json
&gt; Content-Length: 22
&gt; 
 upload completely sent off: 22 out of 22 bytes
&lt; HTTP/1.1 201 Created
&lt; Content-Length: 1152
&lt; Location: http://localhost:7474/db/data/node/30876
&lt; Content-Encoding: UTF-8
&lt; Content-Type: application/json
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
{
  "extensions" : {
  },
  "paged_traverse" : "http://localhost:7474/db/data/node/30876/paged/traverse/{returnType}{?pageSize,leaseTime}",
  "outgoing_relationships" : "http://localhost:7474/db/data/node/30876/relationships/out",
  "traverse" : "http://localhost:7474/db/data/node/30876/traverse/{returnType}",
  "all_typed_relationships" : "http://localhost:7474/db/data/node/30876/relationships/all/{-list|&amp;|types}",
  "property" : "http://localhost:7474/db/data/node/30876/properties/{key}",
  "all_relationships" : "http://localhost:7474/db/data/node/30876/relationships/all",
  "self" : "http://localhost:7474/db/data/node/30876",
  "properties" : "http://localhost:7474/db/data/node/30876/properties",
  "outgoing_typed_relationships" : "http://localhost:7474/db/data/node/30876/relationships/out/{-list|&amp;|types}",
  "incoming_relationships" : "http://localhost:7474/db/data/node/30876/relationships/in",
  "incoming_typed_relationships" : "http://localhost:7474/db/data/node/30876/relationships/in/{-list|&amp;|types}",
  "create_relationship" : "http://localhost:7474/db/data/node/30876/relationships",
  "data" : {
    "name" : "That is it"
  }
 Connection #0 to host localhost left intact
}* Closing connection #0
</pre>


<p>
In the <code>Location</code> response header the node identifies itself with its URI, as it foreseen in for ~POST~s.
</p>
<p>
Finally, we can also <code>DELETE</code> the node again:
</p>


<pre class="example">$  curl -v -XDELETE http://localhost:7474/db/data/node/30876
 About to connect() to localhost port 7474 (#0)
   Trying ::1...
 Connection refused
   Trying 127.0.0.1...
 connected
 Connected to localhost (127.0.0.1) port 7474 (#0)
&gt; DELETE /db/data/node/30876 HTTP/1.1
&gt; User-Agent: curl/7.27.0
&gt; Host: localhost:7474
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 204 No Content
&lt; Access-Control-Allow-Origin: *
&lt; Server: Jetty(6.1.25)
&lt; 
 Connection #0 to host localhost left intact
 Closing connection #0
</pre>


<p>
The next <code>GET</code> to this resource returns new a 404.
</p>
<p>
In general, Neo4j's  RESTful interface allows to 
</p><ul>
<li>access nodes and relationships
</li>
<li>create, update and delete nodes and relationships
</li>
<li>traverse the graph by following outcoming and incoming relationships of a node by following links
</li>
<li>executing Cypher queries
</li>
<li>creating and modifying indexes
</li>
</ul>


<p>
and more
</p>
<p>
Properties are typed and support largely "classical" atomic types: boolean, byte, int, short, long, float, double, char and String.
</p>
</div>

</div>

<div id="outline-container-11-3" class="outline-3">
<h3 id="sec-11-3"><span class="section-number-3">11.3</span> Cypher</h3>
<div class="outline-text-3" id="text-11-3">

<p>Cypher is the name of Neo4j's query language. It is fully specified in chapter 15 of Neo4j's user manual.
</p>
<p>
A Cypher query can find nodes and relationships, create, update  and delete them and extract parts of them.
</p>
</div>

</div>

<div id="outline-container-11-4" class="outline-3">
<h3 id="sec-11-4"><span class="section-number-3">11.4</span> Neocons</h3>
<div class="outline-text-3" id="text-11-4">


<p>
With neocons {Klishin:uc} Neo4j has an intuitive Clojure interface that permits at the same time  to store, update and query the graph inside the database.
</p>
<p>
Dependencies are:
</p>



<pre class="example">(defproject b5 "0.3.0-SNAPSHOT"
  :dependencies [[org.clojure/clojure "1.4.0"]
                 [clojurewerkz/neocons "1.1.0-beta1"]])
</pre>


<p>
Neocons is well documented with most tutorials available under <a href="http://clojureneo4j.info/">http://clojureneo4j.info/</a>
</p>
<ul>
<li id="sec-11-4-1">Initializing the connection<br/>



<pre class="example">(def ^:dynamic *connection-string* "http://localhost:7474/db/data/")

(clojurewerkz.neocons.rest/connect! *connection-string*)
</pre>


<p>
Neocons can handle only one connection at a time, but that is sufficient for our needs.
</p>

</li>
</ul>
<ul>
<li id="sec-11-4-2">Creating nodes and relationships<br/>
The <code>create</code> method unsurprisingly creates nodes:




<pre class="example">(clojurewerkz.neocons.rest.nodes/create {:name "Name" :prop1 "Some value"})
</pre>


<p>
The method returns the node created, uniquely identified by its node number.
</p>
<p>
Similarly, 
</p>



<pre class="example">(clojurewerkz.neocons.rest.relationships/create fst-node snd-node :link-type {:prop1 "Some value" :prop2 "Some other value"})
</pre>


<p>
creates a new relationship and return it.
</p>
</li>
</ul>
<ul>
<li id="sec-11-4-3">Updating nodes and relationships<br/>
Updating properties of nodes works via an update function (like for the REST interface there is no update of nodes per se):




<pre class="example">For all properties of a node:
(clojurewerkz.neocons.rest.nodes/update (:id node-to-be-updated) {:prop1 "Some value" :prop2 "Some other value"})

For a single property:
(clojurewerkz.neocons.rest.nodes/set-property (:id node-to-be-updated) :prop1 "Some value")
</pre>


<p>
and the same for relationships:
</p>



<pre class="example">(clojurewerkz.neocons.rest.relationships/update  (:id rel-to-be-updated) {:prop1 "Some value" :prop2 "Some other value"})

(clojurewerkz.neocons.rest.nodes/set-property (:id rel-to-be-updated) :prop1 "Some value")
</pre>


</li>
</ul>
<ul>
<li id="sec-11-4-4">Creating indexes<br/>

<p>
Like all databases Neo4j also supports indexes, typically on some properties. Creating and handling those indexes is a bit unusual, though, in that you have to ensure that individual entries are added to the index.
</p>
<p>
There are two types of indexes, one for nodes and one for relationships:
</p>



<pre class="example">(clojurewerkz.neocons.rest.nodes/create-index "name-of-node-index" {:unique true}))

(clojurewerkz.neocons.rest.relationships/create-index "name-of-relationship-index" {:unique true}))
</pre>


<p>
The name is later referred to when adding individual entries to the index:
</p>



<pre class="example">(clojurewerkz.neocons.rest.nodes/add-to-index (:id node-to-be-indexed) "name-of-node-index" "name-of-property" value)

(clojurewerkz.neocons.rest.relationships/add-to-index  (:id rel-to-be-indexed) "name-of-relationship-index" property-as-keyword value))
</pre>


</li>
</ul>
<ul>
<li id="sec-11-4-5">Finding nodes and relationships<br/>
Assuming that we have an index "idx" created, we can use it to retrieve it again:




<pre class="example">;Find all nodes where name-of-property has value
(clojurewerkz.neocons.rest.nodes/find "idx" property-keyword value)

;Find the node (maximum one) where name-of-property has value
(clojurewerkz.neocons.rest.nodes/find-one "idx" property-keyword  value)
</pre>


<p>
and the same for relationships:
</p>



<pre class="example">;Find all nodes where name-of-property has value
(clojurewerkz.neocons.rest.relationships/find "idx" property-keyword value)

;Find the node (maximum one) where name-of-property has value
(clojurewerkz.neocons.rest.relationships/find-one "idx" property-keyword  value)
</pre>


<p>
In addition, we can run Cypher queries using:
</p>


<pre class="example">
(clojurewerkz.neocons.rest.cypher/tquery "START n = node(*) WHERE has(n.name) and n.name = \"B5\" RETURN n;")
</pre>


<p>
The result is a list of maps.
</p>
<p>
In addition, we can traverse the graph, but that we will not cover here.
</p>

</li>
</ul>

</div>

<div id="outline-container-11-4-1" class="outline-4">
<h4 id="sec-11-4-1"><span class="section-number-4">11.4.1</span> Assignment</h4>
<div class="outline-text-4" id="text-11-4-1">

<p>Read an aggregated ATOM feeds such as Planet Clojure using the clj-rome library. The feed contains pointers to various other feeds. Extract the feed, its entries and the references to the original feeds and build a graph in Neo4j that has
</p>
<ul>
<li>a node for the aggregated feed
</li>
<li>a node for each feed entry
</li>
<li>a node for each source feed
</li>
<li>a link from the entry node to its aggregated feed
</li>
<li>a link from the entry node to its source feed
</li>
</ul>


<p>
This graph also is a social graph of interactions between feeds in a given domain.
</p>
<p>
Work in teams of two, but hand in the results individually via the project's Moodle page. Indicate in the comments your team partner.
</p>

</div>
</div>

</div>

<div id="outline-container-11-5" class="outline-3">
<h3 id="sec-11-5"><span class="section-number-3">11.5</span> Accessing RESTful storage</h3>
<div class="outline-text-3" id="text-11-5">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2012-11-03 Sat</span></span>
</p>
<p>
EMC2 ATMOS self-describes itself as a 
</p><blockquote>

<p>Cloud storage platform that lets enterprises and service providers store, manage, and protect globally distributed, unstructured content at scale. Atmos provides the essential building blocks to implement a private, public, or hybrid cloud storage environment. (<a href="http://www.emc.com/storage/atmos/atmos.htm">http://www.emc.com/storage/atmos/atmos.htm</a>)
</p>
</blockquote>


<p>
It is developed by EMC Corporation, currently accourding to wikipedia the "the largest provider of data storage platforms in the world" and mother company to companies such as VMware, Iomega and Documentum. ATMOS can be used both as a hardware and software stack. It is meant for very big storage systems up to many petabytes of size. It can be deployed both in a public and a private cloud. In this it directly competes with services such as Amazon's S3 (Simple Storage Service) service and in fact has the S3 API as one of its options.
</p>
<p>
The overall architecture of EMC ATMOS is described in one of the company's whitepapers,  <a href="http://belgium.emc.com/collateral/software/white-papers/h9505-emc-atmos-archit-wp.pdf">http://belgium.emc.com/collateral/software/white-papers/h9505-emc-atmos-archit-wp.pdf</a>. 
</p>
<p>
The reason to explain RESTful APIs for cloud storage  with EMC2 ATMOS is you can get a free developer account to test the API: <a href="https://community.emc.com/docs/DOC-10405">https://community.emc.com/docs/DOC-10405</a>. The API documentation is available via <a href="https://community.emc.com/docs/DOC-10404">https://community.emc.com/docs/DOC-10404</a> (with links to various libraries implementing that interface) and <a href="https://community.emc.com/docs/DOC-14430">https://community.emc.com/docs/DOC-14430</a> (for the documetnation itself).
</p>



</div>

<div id="outline-container-11-5-1" class="outline-4">
<h4 id="sec-11-5-1"><span class="section-number-4">11.5.1</span> Security</h4>
<div class="outline-text-4" id="text-11-5-1">

<p>The Atmos Online Programmers Guide 2.01 specifies on p. 99 the details on how to handle security:
</p>
<ul>
<li id="sec-11-5-1-1">Calculate a hash of the core http request itself<br/>
Dependencies on 



<pre class="example">[commons-codec/commons-codec "1.4"]
</pre>


<p>
The overall formula to calculate a signature is:
</p>


<pre class="example">HTTPRequestMethod + '\n' +
   ContentType + '\n' +
   Range + '\n' +
   Date + '\n' +
   CanonicalizedResource + '\n' +
   CanonicalizedEMCHeaders
</pre>


<p>
where <code>CanonicalizedResource</code> is the path and query part of the request-URI, in lower-case and <code>CanonicalizedEMCHeaders</code> are EMC-specific HTTP headers, prepared according to a given algorithm.
</p>
</li>
</ul>
<ul>
<li id="sec-11-5-1-2">Signing a request<br/>

<p>
The signature of the request is itself transmitted as a custom http header <code>x-emc-signature</code>:
</p>
<p>
For a request like:
</p>


<pre class="example">{"x-emc-uid" "33115732f3b7455d9d2344ddd235f4b9/user1", "content-type" "application/octet-stream", "x-emc-date" "Fri, 02 Nov 2012 14:15:19 GMT", "x-emc-useracl" "user1"}
</pre>


<p>
with <code>POST</code> as method on <a href="https://api.atmosonline.com/rest/objects">https://api.atmosonline.com/rest/objects</a> and a secret key of <code>LJLuryj6zs8ste6Y3jTGQp71xq0=</code> (these are the values for UID and secret key given as an example in the manual) the result is a signature is <code>mIAtBPko+OFST0l0hKsgFxA3/4s=</code>:
</p>



<pre class="example">(s6.atmos/sign "LJLuryj6zs8ste6Y3jTGQp71xq0" "POST" "rest/objects" {"x-emc-uid" "33115732f3b7455d9d2344ddd235f4b9/user1", "content-type" "application/octet-stream", "x-emc-date" "Fri, 02 Nov 2012 14:15:19 GMT", "x-emc-useracl" "user1"})
--&gt; "mIAtBPko+OFST0l0hKsgFxA3/4s="
</pre>


<p>
giving the complete set of headers:
</p>



<pre class="example">{"x-emc-signature" "mIAtBPko+OFST0l0hKsgFxA3/4s=", "x-emc-uid" "33115732f3b7455d9d2344ddd235f4b9/user1", "content-type" "application/octet-stream", "x-emc-date" "Fri, 02 Nov 2012 14:15:19 GMT", "x-emc-useracl" "user1"}
</pre>


<p>
To prevent replay attacks <code>x-emc-date</code> must be recent (within 5 minutes of the server time), otherwise a request is rejected.
</p>
</li>
</ul>
</div>

</div>

<div id="outline-container-11-5-2" class="outline-4">
<h4 id="sec-11-5-2"><span class="section-number-4">11.5.2</span> Creating an object</h4>
<div class="outline-text-4" id="text-11-5-2">

<p>Objects are as usual created via <code>POST</code> requests:
</p>


<pre class="example">curl -v -XPOST -d "ATMOS, here I come" --header "x-emc-uid: UID" --header "content-type: application/octet-stream" --header "x-emc-date: Fri, 02 Nov 2012 14:15:19 GMT" --header "x-emc-useracl: A60284312655ec6780c9" --header "x-emc-signature: 6WqDxVWWvbOC3ZQGGD+hkvK+8sk=" https://api.atmosonline.com/rest/objects
</pre>


<p>
If successful, the request returns a <code>201</code> and contains amongst other information a location header that points to the new object:
</p>



<pre class="example">location: /rest/objects/4ee696e4a41f549604f0b75398081305093d5f6d1950
</pre>


<p>
Alternatively, objects can also be created in a "logical" namespace by <code>POST~ing to ~/rest/namespace</code> with a URI afterwards that is interpreted as a directory:
</p>



<pre class="example">(create-object-in-namespace UUID SECRET USERID "/results/res3.xml" (slurp "/tmp/res3.xml") "author=ABC,date=2012-11-02")
</pre>


<p>
resulting in the object and its tag structure being created. However, again the API returns the object id in the location header to uniquely identify the resulting object:
</p>



<pre class="example">location: /rest/objects/4ee696e4a31f549604f0b753961dcc0509435479c09f
</pre>


</div>

</div>

<div id="outline-container-11-5-3" class="outline-4">
<h4 id="sec-11-5-3"><span class="section-number-4">11.5.3</span> Atmosfox</h4>
<div class="outline-text-4" id="text-11-5-3">

<p>A Firefox plugin, Atmosfox, allows to navigate remote files in somewhat Norton-commander-style.
</p>
<p>
In the following screenshots we see the restults of the previous command, as shown in Atmosfox in object view:
</p>
<p>
<a href="#img-atmosfox_files.png">img/atmosfox_files.png</a>
</p>
<p>
<a href="#img-atmosfox_author_date.png">img/atmosfox_author_date.png</a>
</p>
<p>
and the same in namespace view:
</p>
<p>
<a href="#img-atmosfox_namespace_view.png">img/atmosfox_namespace_view.png</a>
</p>
</div>

</div>

<div id="outline-container-11-5-4" class="outline-4">
<h4 id="sec-11-5-4"><span class="section-number-4">11.5.4</span> Handling of Metadata</h4>
<div class="outline-text-4" id="text-11-5-4">


<p>
All objects have system metadata. They can also have user-defined metadata that is transmitted in the custom header <code>x-emc-listable-meta</code> and has the form <code>tag_name1=value1,tag_name2=value2</code>. For metadata that is just stored, but not searchable there is yet another header called <code>x-emc-meta</code>.
</p>
<p>
The general approach for accessing metadata is:
</p>
<p>
For system level metadata:
</p>



<pre class="example">/rest/objects/&lt;objectID&gt;?metadata/system
or 
/rest/namespace/&lt;pathname&gt;?metadata/system
</pre>


<p>
This gives for example:
</p>



<pre class="example">(get-system-metadata UUID SECRET-KEY "4ee696e4a31f549604f0b753961dcc0509435479c09f")
{:trace-redirects ["https://api.atmosonline.com/rest/objects/4ee696e4a31f549604f0b753961dcc0509435479c09f?metadata/system"], :request-time 2703, :status 200, :headers {"date" "Sat, 03 Nov 2012 07:20:11 GMT", "server" "Apache", "x-emc-policy" "_int", "x-emc-meta" "atime=2012-11-02T21:04:07Z, mtime=2012-11-02T21:04:07Z, ctime=2012-11-02T21:04:07Z, itime=2012-11-02T21:04:07Z, type=regular, uid=A60284312655ec6780c9, gid=apache, objectid=4ee696e4a31f549604f0b753961dcc0509435479c09f, objname=res3.xml, size=1957, nlink=1, policyname=default", "content-length" "0", "connection" "close", "content-type" "text/plain; charset=UTF-8"}, :body ""}
</pre>


<p>
By default all system-level metadata is returned. Using <code>x-emc-tags</code> it is possible to filter.
</p>
<p>
For user metadata the approach is quite the same:
</p>



<pre class="example">/rest/objects/&lt;objectID&gt;?metadata/user
or 
/rest/namespace/&lt;pathname&gt;?metadata/user
</pre>


<p>
giving for example:
</p>



<pre class="example">(get-user-metadata UUID SECRET-KEY "4ee696e4a31f549604f0b753961dcc0509435479c09f")
{:trace-redirects ["https://api.atmosonline.com/rest/objects/4ee696e4a31f549604f0b753961dcc0509435479c09f?metadata/user"], :request-time 1650, :status 200, :headers {"date" "Sat, 03 Nov 2012 07:21:15 GMT", "server" "Apache", "x-emc-policy" "_int", "x-emc-listable-meta" "author=ABC, date=2012-11-02", "content-length" "0", "connection" "close", "content-type" "text/plain; charset=UTF-8"}, :body ""}
</pre>


<p>
Again, it is possible to filter with <code>x-emc-tags</code>.
</p>
</div>

</div>

<div id="outline-container-11-5-5" class="outline-4">
<h4 id="sec-11-5-5"><span class="section-number-4">11.5.5</span> Assignment</h4>
<div class="outline-text-4" id="text-11-5-5">

<p>Continue yesterday's assignment, but devise namespaces to actually store the corresponding entries in the ATMOS developer acount (for a few examples). Have Neo4j store those references as content references.
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12"><span class="section-number-2">12</span> Excursion: Clojure and JVM</h2>
<div class="outline-text-2" id="text-12">


</div>

<div id="outline-container-12-1" class="outline-3">
<h3 id="sec-12-1"><span class="section-number-3">12.1</span> Why Clojure?</h3>
<div class="outline-text-3" id="text-12-1">

<p>Clojure is a Lisp for the JVM, the Java platform. It combines the advantages of Lisp, notably its flexible and clean syntax, with full interoperability with existing Java libraries and excellent support for concurrent programming. 
</p>
<p>
At here two ultimatively simple examples:
</p>


<pre class="example">user=&gt; (+ 1 1)
2
user=&gt; (println "Hello World!")
Hello World!
nil
user=&gt; 
</pre>


<p>
Like other Lisps Clojure employs prefix notation for function calls. Things like <code>+</code> that in other languages are separate operators are ordinary functions, following the same logic as any other function. In the case of <code>+</code> we have what is called a <i>pure</i> function that does not produce side-effects. The <code>println</code> in turn does not return anything useful &mdash; though it does return something, the value <code>nil</code> &mdash;, but it triggers a side action, namely to print out a string on the console.
</p>
<p>
Before we elaborate more on the advantages let's have a look at some slightly more complex Clojure code (example inspired by , p.3):
</p>



<pre class="example">user=&gt; (defn all-lower? [s] (every? #(Character/isLowerCase %) s))
#'user/all-lower?
user=&gt; (all-lower? "aBc")
false
user=&gt; (all-lower? "abc")
true
</pre>


<p>
This short code defines boolean function &mdash; a predicate &mdash; with one parameter using <code>defn</code>. This function checks if all characters in a string are lower-case. It works by just checking if another predicate, -Character/isLowerCase- is true for every character in the string. If so, it returns <code>true</code>, otherwise <code>false</code>.
</p>
<p>
Already this example is a typical use of functions that themselves call functions (higher-order functions). We can, however, use this function in turn in a larger context, e.g. to filter all all-lower-case strings from a list of strings
</p>


<pre class="example">user=&gt; (filter all-lower? '("aBc" "deF" "hij" "Klm" "nop" "QRS" "tuV" "WXy" "z"))
("hij" "nop" "z")
user=&gt; 
</pre>


<p>
That code demonstrates two things:
</p><ul>
<li>Combination of functions allows for a highly declarative style of programming. The above code ready almost like an instruction in ordinary language: filter all strings from this list of string that are in all lower case
</li>
<li>Like all Lisps Clojure follows a philosophy of "code is data", i.e. there are no structural differences between Lisp code and data structures (everything look structurally the same). This principle is known as homoiconicity.
</li>
</ul>


<p>
Function definitions can be more complex in that you can have multiple set of parameters, in the following case none (case -[]-), one (case -[name]-) and two (case -[phrase name]):
</p>


<pre class="example">(defn hello
  ([]
     (hello "Hello" "World"))
  ([name]
     (hello "Hello" name))
  ([phrase name]
     (str phrase ", " name)))
</pre>


<p>
Based on the parameters given the right function is chosen:
</p>



<pre class="example">user=&gt; (hello)
"Hello, World"
user=&gt; (hello "Worms")
"Hello, Worms"
user=&gt; (hello "Hallo" "Worms")
"Hallo, Worms"
user=&gt; 
</pre>





<p>
On this basis we can now look at some more of the advantages:
</p>
<ul>
<li>Elegant and concise syntax
</li>
<li>Largely immutable data structures
</li>
<li>Excellent support for concurrent programming
</li>
<li>Close JVM integration
</li>
</ul>


<p>
Recommended reading: {Halloway:2012ta}
</p>
</div>

</div>

<div id="outline-container-12-2" class="outline-3">
<h3 id="sec-12-2"><span class="section-number-3">12.2</span> Practicalities</h3>
<div class="outline-text-3" id="text-12-2">


</div>

<div id="outline-container-12-2-1" class="outline-4">
<h4 id="sec-12-2-1"><span class="section-number-4">12.2.1</span> Tutorials</h4>
<div class="outline-text-4" id="text-12-2-1">

<p>A number of Clojure tutorials exist on the Web, both as written tutorials and as podcasts. In addition, a number of books have appeared:
</p>
<ul>
<li id="sec-12-2-1-1">Books<br/>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup>     S. Halloway and A. Bedra, Programming Clojure, Second Edition. Pragmatic Bookshelf, 2012.
</p>
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup>     C. Emerick, B. Carper, and C. Grand, “Clojure Programming - Practical LISP for the Java World.,” O'Reilly 2012, 
</p>
</li>
</ul>
<ul>
<li id="sec-12-2-1-2">Podcasts<br/>

<p>
<a href="http://blip.tv/clojure/clojure-for-java-programmers-1-of-2-989128">http://blip.tv/clojure/clojure-for-java-programmers-1-of-2-989128</a>
</p>
<p>
<a href="http://blip.tv/clojure/clojure-for-java-programmers-2-of-2-989262">http://blip.tv/clojure/clojure-for-java-programmers-2-of-2-989262</a>
</p>
</li>
</ul>
<ul>
<li id="sec-12-2-1-3">API<br/>
The Clojure API is documented under <a href="http://clojure.github.com/clojure/">http://clojure.github.com/clojure/</a>

</li>
</ul>
</div>

</div>

<div id="outline-container-12-2-2" class="outline-4">
<h4 id="sec-12-2-2"><span class="section-number-4">12.2.2</span> Installation and integration with Emacs</h4>
<div class="outline-text-4" id="text-12-2-2">

<ol>
<li>Download leiningen 2.0
</li>
</ol>


<p>
Download from <a href="http://leiningen.org/">http://leiningen.org/</a>
</p>



<pre class="example">wget https://raw.github.com/technomancy/leiningen/preview/bin/lein

chmod 755 lein

./lein self-install
</pre>


<p>
then move lein to a place in the PATH
</p>
<ol>
<li>Install package manager
</li>
</ol>


<p>
Only for Emacs 23: 
</p>
<p>
Install the Marmalade package manager
</p>



<pre class="example">(require 'package)
(add-to-list 'package-archives
             '("marmalade" . "http://marmalade-repo.org/packages/"))
(package-initialize)
</pre>


<ol>
<li>Install clojure-mode
</li>
</ol>


<p>
<a href="https://github.com/technomancy/clojure-mode">https://github.com/technomancy/clojure-mode</a>
</p>
<ol>
<li>Install nrepl
</li>
</ol>


<p>
<a href="https://github.com/kingtim/nrepl.el">https://github.com/kingtim/nrepl.el</a>
</p>
<p>
M-x package-install [RET] nrepl [RET]
</p>
<p>
Configure in .emacs:
</p>


<pre class="example">(require 'package)
(add-to-list 'package-archives
             '("marmalade" . "http://marmalade-repo.org/packages/") t)
(add-to-list 'package-archives
             '("melpa" . "http://melpa.milkbox.net/packages/") t)
(package-initialize)

(require 'clojure-mode) ;;https://github.com/technomancy/clojure-mode/blob/master/clojure-mode.el

(setq inferior-lisp-program "lein repl")
(setq clojure-swank-command ;; https://github.com/pallet/ritz/tree/develop/swank
  (if (or (locate-file "lein" exec-path) (locate-file "lein.bat" exec-path))
    "lein ritz-in %s"
    "echo \"lein ritz-in %s\" | $SHELL -l"))
</pre>


<ol>
<li>Start nrepl
</li>
</ol>


<p>
M-x nrepl-jack-in
</p>
<p>
For Eclipse users there is the Counterclockwise plugin that can be used instead (<a href="http://code.google.com/p/counterclockwise/">http://code.google.com/p/counterclockwise/</a>). For installation instructions see there.
</p>
</div>

</div>

<div id="outline-container-12-2-3" class="outline-4">
<h4 id="sec-12-2-3"><span class="section-number-4">12.2.3</span> Leiningen</h4>
<div class="outline-text-4" id="text-12-2-3">

<p>Leiningen (<a href="http://leiningen.org">http://leiningen.org</a>) is the standard tool for managing dependencies for Clojure. It builds on the standard Java tool for this purpose, Maven, but adds a much more simpler syntax to express dependencies.
</p>
<p>
Like Maven projects Leiningen projects have a predefined directory structure:
</p>



<pre class="example">project/src            Source code
       /test           Unit tests
       /project.clj    Dependency file
</pre>


<p>
Project files with the dependency structure just list the packages and their desired versions:
</p>



<pre class="example">(defproject eu.budabe/eli-project "0.1" 
  :dependencies [[org.clojure/clojure "1.4.0"]
                 [clj-http "0.5.3"]
                 [cheshire "4.0.2"]
                 [org.clojure/data.zip "0.1.0"]])
</pre>


<p>
Leiningen itself will then automatically download the necessary libraries and install them as necessary. Much like Python, Perl and Ruby Clojure has a universally accepted central repository <a href="http://clojars.org">http://clojars.org</a> which hosts Clojure libraries. In addition, all "normal" Java libraries can also be used.
</p>
<p>
Leiningen itself has a number of options, most of which are self-explanatory.
</p>



<pre class="example">marcwilhelmkuster$ lein --help
Leiningen is a tool for working with Clojure projects.

Several tasks are available:
check               Check syntax and warn on reflection.
classpath           Write the classpath of the current project to output-file.
clean               Remove all files from project's target-path.
compile             Compile Clojure source into .class files.
deploy              Build jar and deploy to remote repository.
deps                Show details about dependencies.
do                  Higher-order task to perform other tasks in succession.
help                Display a list of tasks or help for a given task.
install             Install current project to the local repository.
jar                 Package up all the project's files into a jar file.
javac               Compile Java source files.
new                 Generate project scaffolding based on a template.
plugin              DEPRECATED. Please use the :user profile instead.
pom                 Write a pom.xml file to disk for Maven interoperability.
repl                Start a repl session either with the current project or standalone.
retest              Run only the test namespaces which failed last time around.
ritz                Launch ritz server for Emacs to connect.
ritz-in             Jack in to a ritz backed Clojure SLIME session from Emacs.
run                 Run the project's -main function.
search              Search remote maven repositories for matching jars.
show-profiles       List all available profiles or display one if given an argument.
test                Run the project's tests.
trampoline          Run a task without nesting the project's JVM inside Leiningen's.
uberjar             Package up the project files and all dependencies into a jar file.
upgrade             Upgrade Leiningen to specified version or latest stable.
version             Print version for Leiningen and the current JVM.
with-profile        Apply the given task with the profile(s) specified.

Run lein help $TASK for details.

Aliases:

See also: readme, faq, tutorial, news, sample, profiles,
deploying and copying.
</pre>


<p>
<code>lein repl</code> starts a Clojure command shell with all dependencies loaded:
</p>


<pre class="example">marcwilhelmkuster$ lein repl
nREPL server started on port 55766
REPL-y 0.1.0-beta10
Clojure 1.4.0
    Exit: Control+D or (exit) or (quit)
Commands: (user/help)
    Docs: (doc function-name-here)
          (find-doc "part-of-name-here")
  Source: (source function-name-here)
          (user/sourcery function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
Examples from clojuredocs.org: [clojuredocs or cdoc]
          (user/clojuredocs name-here)
          (user/clojuredocs "ns-here" "name-here")
user=&gt; (+ 1 1)
2
user=&gt; (defn all-lower? [s] (every? #(Character/isLowerCase %) s))
#'user/all-lower?
user=&gt; (all-lower? "aBc")
false
user=&gt; (all-lower? "abc")
true
user=&gt; 
</pre>


<p>
<code>lein new PROJECT</code> creates a new empty project structure with placeholders for all important files:
</p>



<pre class="example">$ lein new b5
Generating a project called b5 based on the 'default' template.
To see other templates (app, lein plugin, etc), try `lein help new`.
$ cd b5
$ find . -name "*"
.
./.gitignore
./doc
./doc/intro.md
./project.clj
./README.md
./src
./src/b5
./src/b5/core.clj
./test
./test/b5
./test/b5/core_test.clj
$ 
</pre>


<p>
The Leiningen tutorial <a href="https://github.com/technomancy/leiningen/blob/master/doc/TUTORIAL.md">https://github.com/technomancy/leiningen/blob/master/doc/TUTORIAL.md</a> illustrates all possible operations in detail.
</p>
</div>

</div>

<div id="outline-container-12-2-4" class="outline-4">
<h4 id="sec-12-2-4"><span class="section-number-4">12.2.4</span> Syntax and data structures</h4>
<div class="outline-text-4" id="text-12-2-4">

<p>We have already seen examples of Clojure's syntax. Function calls are of the type:
</p>


<pre class="example">user=&gt; (function-name params listed)
</pre>



<p>
Defining new functions is as simple:
</p>


<pre class="example">(defn all-lower? [s] (every? #(Character/isLowerCase %) s))
</pre>


<p>
In total the following primitive data structures exist in Clojure:
</p>


<pre class="example">Boolean: true | false
Character: \a \b \c
String: "abc"
List: ("a" "b" "c") (all-lower? "abc")
Map: {:key1 "Value1", :key2 "Value2"}
Number: 1.23
Set: #{ 1 2 3}
Vector: [1 2 3]

Symbol: eli/build-act
Keywords: :keyword :name
Nil: nil
</pre>


<ul>
<li id="sec-12-2-4-1">Lists<br/>
Lisps are famous for using lists. In Clojure lists are also key to the syntax, but not anywhere as strongly as in classical Lisps.




<pre class="example">user=&gt; (list 1 2 3)
(1 2 3)
user=&gt; (list 1 2 "a" "b")
(1 2 "a" "b")
user=&gt; '(1 2 "a" "b")
(1 2 "a" "b")
user=&gt; (quote (1 2 "a" "b"))
(1 2 "a" "b")
user=&gt; (list 1 2 (+ 3 4))
(1 2 7)
user=&gt; '(1 2 (+ 3 4))
(1 2 (+ 3 4))
user=&gt; 
</pre>


<p>
As we have seen, also function calls are lists:
</p>


<pre class="example">user=&gt; (all-lower? "abc")
true
</pre>



</li>
</ul>
<ul>
<li id="sec-12-2-4-2">Vectors<br/>
Vectors are Clojure's equivalent to arrays. They are indexed, indexes can be used to address individual elements in the vector.



<pre class="example">user=&gt; [1 2 3]
[1 2 3]
user=&gt; (def v [1 2 3])
#'user/v
user=&gt; (vector? v)
true
user=&gt; (v 1)
2
user=&gt; 
user=&gt; [1 2 "a" "b"]
[1 2 "a" "b"]
user=&gt; 
</pre>


<p>
Vectors themselves can be used as functions, taking the relevant index as a parameter.
</p>
</li>
</ul>
<ul>
<li id="sec-12-2-4-3">Maps<br/>
Maps are very much the bread and butter data structure in Clojure and are used to model flexible data structures:




<pre class="example">user=&gt; {:first-name "Marc", :last-name "Kuester"}
{:last-name "Kuester", :first-name "Marc"}
user=&gt; (def kuester {:first-name "Marc", :last-name "Kuester"})
#'user/kuester
user=&gt; (:last-name kuester)
"Kuester"
user=&gt; 
</pre>


<p>
Using the comma to separate key-value-pairs is optional. All data structures can be used as as keys, though keywords are the most common case. Keywords can also be used as functions, they return the value corresponding to this key in the map.
</p>
</li>
</ul>
<ul>
<li id="sec-12-2-4-4">-defrecord-<br/>
In addition, you can easily define new data structures in the form of records:



<pre class="example">user=&gt; (defrecord Teacher [first-name last-name office-no])
user.Teacher
user=&gt; (-&gt;Teacher "Marc" "Kuester" 123)
#user.Teacher{:first-name "Marc", :last-name "Kuester", :office-no 123}
user=&gt; (:first-name (-&gt;Teacher "Marc" "Kuester" 123))
"Marc"
user=&gt; 
</pre>



</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-12-3" class="outline-3">
<h3 id="sec-12-3"><span class="section-number-3">12.3</span> Control structures</h3>
<div class="outline-text-3" id="text-12-3">

<p>Clojure has at its core only very simple comtrol structures: <code>if</code>, <code>do</code> and <code>loop</code>. Of these, however, you use only <code>if</code> regularly and directly:
</p>



<pre class="example">user=&gt; (defn all-lower? [s] (every? #(Character/isLowerCase %) s))
user=&gt; (if (all-lower? "abc") "all lower case" "also capital letters")
"all lower case"
user=&gt; 
</pre>


<p>
The first branch is used if the condition is true ("then-branch"), the second one if it is false ("else-branch"). Incidentally, if is a function like all other functions, returning the then or else branch as the case may be.
</p>



<pre class="example">user=&gt; (def a (if (all-lower? "abc") "all lower case" "also capital letters"))
#'user/a
user=&gt; a
"all lower case"
user=&gt; (def b (if (all-lower? "aBc") "all lower case" "also capital letters"))
#'user/b
user=&gt; b
"also capital letters"
user=&gt; 
</pre>


<p>
<code>do</code> is needed if for some reason more than one action is needed in the then or else branch. By necessity, these other actions are defined by their side effect:
</p>


<pre class="example">user=&gt;  (if (all-lower? "aBc") (do (println "then") "all lower case") (do (println "else") "also capital letters"))
else
"also capital letters"
user=&gt; 
</pre>



<p>
<code>loop</code> is hardly ever used directly. Here an example of a loop that calculates the squares of all even numbers:
</p>


<pre class="example">;;very complicated, do not use
(loop [lst '(1 2 3 4 5 6) res '()]  
(let [l (last lst)]
(if (empty? lst)
  res
  (recur (drop-last lst) (if (even? l) (cons (* l l) res) res)))))
</pre>


<p>
As usual for Lisps these primitive control structures are replaced by more powerful abstractions built on top of these basic building blocks. These include <code>for</code> and <code>when</code>. <code>for</code>, however, has little in common with a for-loop in, say, C. Ui stead it is a close parent of the list comprehensions that exist e.g. in Python:
</p>



<pre class="example">user=&gt; (for [i '(1 2 3 4 5 6) :when (even? i)] (* i i))
(4 16 36)
user=&gt; 
</pre>


<p>
Really, the use of explicit control structures is much rarer in Clojure than in traditional imperative languages. Instead, higher-order functions operating on sequences are the bread and butter of Clojure ans indeed of functional programming in general.
</p>
<p>
So, instead of using the above idiom to output the squares of even numbers a even more idiomatic approach would be:
</p>



<pre class="example">user=&gt; (map (fn [i] (* i i)) (filter even? '(1 2 3 4 5 6)))
(4 16 36)
user=&gt; 
</pre>


<p>
or even shorter
</p>



<pre class="example">user=&gt; (map  #(* % %) (filter even? '(1 2 3 4 5 6)))
(4 16 36)
user=&gt; 
</pre>


<p>
This makes usually for much clearer code.
</p>
</div>

</div>

<div id="outline-container-12-4" class="outline-3">
<h3 id="sec-12-4"><span class="section-number-3">12.4</span> Lazy sequences</h3>
<div class="outline-text-3" id="text-12-4">

<p>However, Clojure still has a surprise  in petto. In contrast to most other languages it does not only know finite, but also infinite sequences. With this we can find a much more flexible definition for our squares of even numbers, one that does not only work for a given finite list '(1 2 3 4 5 6), but for any type of range:
</p>


<pre class="example">user=&gt; (defn even-squares [] (map #(* % %) (filter even? (range))))
#'user/even-squares
user=&gt; (take 10 (even-squares))
(0 4 16 36 64 100 144 196 256 324)
user=&gt; (take 50 (even-squares))
(0 4 16 36 64 100 144 196 256 324 400 484 576 676 784 900 1024 1156 1296 1444 1600 1764 1936 2116 2304 2500 2704 2916 3136 3364 3600 3844 4096 4356 4624 4900 5184 5476 5776 6084 6400 6724 7056 7396 7744 8100 8464 8836 9216 9604)
user=&gt; 
</pre>


<p>
or even shorter
</p>



<pre class="example">user=&gt; (defn even-squares [] (map #(* % %)  (range 0 Double/POSITIVE_INFINITY 2)))
#'user/even-squares
user=&gt; (take 10 (even-squares))
(0 4 16 36 64 100 144 196 256 324)
user=&gt; 
</pre>



<p>
This may look rather surprising &mdash; how can a language treat infinite sequences? This only works because Clojure treats these sequences as so-called lazy sequences that are instantiated &mdash; realized is the term &mdash; only when really used. So, before we actually take the first 10 squares, nothing is calculated. Only the moment that we really want to print those 10 and then in a second round 50 squares are they really calculated. Results that are no longer needed can be garbage collected.
</p>
<p>
Lazy sequences make for elegant code also for finite, but potentially large sequences. Results of database queries can be of considerable size and often necessitate paging to treat batches of results one after the other. Lazy sequences can abstract from this detail without loading all results into memory. 
</p>
</div>

</div>

<div id="outline-container-12-5" class="outline-3">
<h3 id="sec-12-5"><span class="section-number-3">12.5</span> Assignment</h3>
<div class="outline-text-3" id="text-12-5">

<ol>
<li>Write a clojure program that takes a list of strings and returns another list of only those strings that start with the character "a", but uppercased. So, e.g. for an input '("xyz" "cde" "abc" "bab" "axx") it should return '("ABC" "AXX"). Write first a unit test and then the function and run lein test to prove it works.
</li>
<li>Write the same program in another programming language of your choice
</li>
</ol>


<p>
Hand in assignment via the course's Moodle page.
</p>

</div>

</div>

<div id="outline-container-12-6" class="outline-3">
<h3 id="sec-12-6"><span class="section-number-3">12.6</span> Principles of functional programming</h3>
<div class="outline-text-3" id="text-12-6">

<p>Session <span class="timestamp-wrapper"> <span class="timestamp">2012-10-19 Fri</span></span>
</p>
<p>
Functional programming centres around a number of key principles that are more or less "purely" realized in the various functional languages:
</p>
<ul>
<li>Immutable data
</li>
<li>Functions as data
</li>
<li>Pure Functions
</li>
<li>Higher-Order Functions
</li>
<li>Use of recursion
</li>
</ul>


<p>
We have seen cases of function as data and higher order functions. These are key to all functional languages and especially to Clojure. Clojure also has a strong preference for pure functions, i.e. functions that have no side-effects and always return the same output for the same input. 
</p>
<p>
The example of the "square of even numbers" functions is built on functions as data (<code>even?</code>, <code>#(* % %)</code> etc.) that are parameters to higher-order functions (<code>filter</code>, <code>map</code>). All of these functions are pure in a mathematical sense.
</p>


<pre class="example">(map  #(* % %) (filter even? '(1 2 3 4 5 6)))
</pre>


<p>
Clojure is less oriented towards explicit recursion as other languages such as Scheme, but they still play an important role. However, the concept of immutable data is at the core of Clojure. All the data structures that we have seen are immutable (and many are in addition lazy). Of course, it is still possible to handle mutable data, and in fact Clojure offers some powerful strategies to handle data updates in transactions (Software Transactional Memory or STM). Transactional references (Refs) make for safe mutable data. However, a detailed discussion of this is out of scope for this session.
</p>
<p>
More information on Clojure and its API is available under <a href="http://clojure.org/">http://clojure.org/</a> and <a href="http://clojuredocs.org/">http://clojuredocs.org/</a>
</p>





</div>

</div>

<div id="outline-container-12-7" class="outline-3">
<h3 id="sec-12-7"><span class="section-number-3">12.7</span> Futures</h3>
<div class="outline-text-3" id="text-12-7">

<p>For long-running calculations Clojure has the concept of futures (<a href="http://clojuredocs.org/clojure_core/clojure.core/future">http://clojuredocs.org/clojure_core/clojure.core/future</a>). A future is calculated in a separate thread, but transparently to the user:
</p>



<pre class="example">(defn get-page [host port]
  (let
      [conn (Socket. host port)
       in (.getInputStream conn)
       out (.getOutputStream conn)]
    (write-request out host)
    (future (read-response in))))
</pre>


<p>
Assuming that <code>read-response</code> takes a considerable time to execute and would block further program execution for the time it takes, <code>(future (read-response in))</code> returns instead a <i>promise</i> to the real value that it will contain. Once the calculation is complete, it will be transparently replaced by the final value, without blocking the current execution:
</p>



<pre class="example">user&gt; (def p (get-page "www.google.de" 80))
GET / HTTP/1.1
Host: www.google.de

Request written
#'user/p
user&gt; p
#&lt;core$future_call$reify__6110@2ca275d8: :pending&gt;
user&gt; 
user&gt; p
#&lt;core$future_call$reify__6110@2ca275d8: :pending&gt;
user&gt; @p
[now execution blocks until the page is fully retrieved]
</pre>


<p>
If you need the guarantee to have the value at a later stage, you can dereference the future by using the <code>@</code> reader macro, e.g. <code>@p</code>. In this case program execution will block until the correct value is calculated, if that is not yet the case.
</p>
</div>

</div>

<div id="outline-container-12-8" class="outline-3">
<h3 id="sec-12-8"><span class="section-number-3">12.8</span> Multimethods: Polymorphism functional style</h3>
<div class="outline-text-3" id="text-12-8">


<p>
Clojure has no native concept of objects (it does have an object concept for interfacing with Java). Instead, it offers named data structures &mdash; records &mdash; as well as functions that can dispatch on them and indeed on many other criteria. In the simplest of cases we have 
</p>



<pre class="example">
(defrecord Variable [text postfix])

(defrecord Token [variables prefix])

(defmulti handle-value 
  "Handling of individual variables. Returns the variable replaced by the supplied values"
  (fn [^Variable variable values separator encoding-fn]
    (class (values (:text variable)))))

(defmethod handle-value String [^Variable variable values separator encoding-fn]
 ;one strategy for strings
)

(defmethod handle-value java.util.Collection [^Variable variable values separator encoding-fn]
 ; another strategy to handle collections
)
; and so on
</pre>


<p>
In the most frequent case dispatching is by data type or class, but it can be by anything else. <code>defmulti</code> defines in its implementation the strategy to be chosen by the individual <code>defmethod</code>.
</p></div>
</div>
</div>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-01-03T18:26+0100</p>
<p class="author">Author: Marc Wilhelm Küster</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
